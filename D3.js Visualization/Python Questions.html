<!DOCTYPE html>

<head>
	<title>Clustering Simulation - Python Questions</title>
	<link rel="stylesheet" href="style.css" type="text/css" media="screen"/>
</head>

<meta charset="utf-8">
<style>.node{stroke-width:1.5px;}</style>

<body style="background-color:black;">

	<div id="main-wrapper">

	<div id="note"></div>

	</div>
	<div id="chart1"></div>
	<div class="clr"></div>
	</div>

	<div id="speed">
	<div class="togglebutton slow" data-val="slow">Slow</div>
	<div class="togglebutton medium current" data-val="medium">Medium</div>
	<div class="togglebutton fast" data-val="fast">Fast</div>
	<div class="clr"></div>
	</div>

	<div id="current_time">Month-Year</div>

	<div id="total_num_top">Total Questions:</div>
	<div id="total_num_bottom">0, 0%</div>

	<div id="chart2"></div>
	<div class="clr"></div>

	<script src="d3.js/d3-3-5-5.min.js"></script>

	<script>

	var USER_SPEED = "medium";

	var speeds = { "slow": 1000, "medium": 200, "fast": 50 };

	var width = 700,
    	height = 700;

	var node_radius = 3.5,
	    padding = 1,
	    cluster_padding = 10,
	    num_nodes = 700;   

	var svg = d3.select("#chart1").append("svg")
    	.attr("width", width)
    	.attr("height", height)
    	.append("g")

	// Foci
	var foci = {
		"center": { x: 350, y: 340, color: "#AFAFB0" },
		0: { x: 350, y: 100, color: "#357C4C" }, 
		1: { x: 590, y: 340, color: "#B91E68" }, 
		2: { x: 470, y: 547.847, color: "#8A5031" },
		3: { x: 230, y: 547.847, color: "#EE5145" },
		4: { x: 110, y: 340, color: "#5F4C86" },
	};

	var cluster_codes = [
		{"index": "0", "name": "Data Analysis/Machine Learning", "tag": "(Matplotlib, Dataframe, Tensorflow)"},
		{"index": "1", "name": "Database Manipulation", "tag": "(MySQL, Table, Migration)"},
		{"index": "2", "name": "DS/Algorithm Based", "tag": "(Dictionary, List, Structure)"},
		{"index": "3", "name": "Back-End Development", "tag": "(App, Flask, Server)"},
		{"index": "4", "name": "Front-End Development", "tag": "(Button, Widget, Client)"},
	];

	var cluster_counts = { "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 0};
	var cluster_yoy = { "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 0};

	// Create node objects
	var nodes = d3.range(0, num_nodes).map(function(o, i) {
		return {
			id: "node" + i,
			x: foci.center.x + Math.random(),
			y: foci.center.y + Math.random(),
			radius: node_radius,
			choice: "center",
		}
	});

	// Force-directed layout
	var force = d3.layout.force()
		.nodes(nodes)
		.size([width, height])
		.gravity(0)
		.charge(0)
		.friction(.91)
		.on("tick", tick)
		.start();
	    
	// Draw circle for each node.
	var circle = svg.selectAll("circle")
		.data(nodes)
	    .enter().append("circle")
		.attr("id", function(d) { return d.id; })
		.attr("class", "node")
		.style("fill", function(d) { return foci[d.choice].color; });

	// Labels

	var label = svg.selectAll("text")
		.data(cluster_codes)
	    .enter().append("text")
		.attr("class", "cluster_label")
		.attr("x", function(d, i) {
			var cluster_index = Number(d.index);
			return foci[cluster_index].x;
		})
		.attr("y", function(d, i) {
			var cluster_index = Number(d.index);
			return foci[cluster_index].y;		
		});
		
	label.append("tspan")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("fill", "#FFFFFF")
		.attr("font-size", "21px")
		.text(function(d) {
			return d.name;
		});

	label.append("tspan")
		.attr("dy", "1.1em")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("fill", "#FFFFFF")
		.attr("font-size", "12px")
		.text(function(d) {
			return d.tag;
		});

	label.append("tspan")
		.attr("dy", "1.2em")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("font-size", "13px")
		.attr("class", "num")
		.attr("fill", "#FFFFFF")
		.text(function(d) {
			return "[" + cluster_counts[d.index] + ", " + "<1%" + ", " + 
			readableChange(cluster_yoy[d.index]) + "]";
		});

	// For smoother initial transition to settling spots.
	circle.transition()
		.duration(900)
		.delay(function(d,i) { return i * 5; })
		.attrTween("r", function(d) {
			var i = d3.interpolate(0, d.radius);
			return function(t) { return d.radius = i(t); };
		});

	var exact_num = 602869;

	var vis_json_text = '{"Month-Year":{"0":"2008-10-01","1":"2008-11-01","2":"2008-12-01","3":"2009-01-01","4":"2009-02-01","5":"2009-03-01","6":"2009-04-01","7":"2009-05-01","8":"2009-06-01","9":"2009-07-01","10":"2009-08-01","11":"2009-09-01","12":"2009-10-01","13":"2009-11-01","14":"2009-12-01","15":"2010-01-01","16":"2010-02-01","17":"2010-03-01","18":"2010-04-01","19":"2010-05-01","20":"2010-06-01","21":"2010-07-01","22":"2010-08-01","23":"2010-09-01","24":"2010-10-01","25":"2010-11-01","26":"2010-12-01","27":"2011-01-01","28":"2011-02-01","29":"2011-03-01","30":"2011-04-01","31":"2011-05-01","32":"2011-06-01","33":"2011-07-01","34":"2011-08-01","35":"2011-09-01","36":"2011-10-01","37":"2011-11-01","38":"2011-12-01","39":"2012-01-01","40":"2012-02-01","41":"2012-03-01","42":"2012-04-01","43":"2012-05-01","44":"2012-06-01","45":"2012-07-01","46":"2012-08-01","47":"2012-09-01","48":"2012-10-01","49":"2012-11-01","50":"2012-12-01","51":"2013-01-01","52":"2013-02-01","53":"2013-03-01","54":"2013-04-01","55":"2013-05-01","56":"2013-06-01","57":"2013-07-01","58":"2013-08-01","59":"2013-09-01","60":"2013-10-01","61":"2013-11-01","62":"2013-12-01","63":"2014-01-01","64":"2014-02-01","65":"2014-03-01","66":"2014-04-01","67":"2014-05-01","68":"2014-06-01","69":"2014-07-01","70":"2014-08-01","71":"2014-09-01","72":"2014-10-01","73":"2014-11-01","74":"2014-12-01","75":"2015-01-01","76":"2015-02-01","77":"2015-03-01","78":"2015-04-01","79":"2015-05-01","80":"2015-06-01","81":"2015-07-01","82":"2015-08-01","83":"2015-09-01","84":"2015-10-01","85":"2015-11-01","86":"2015-12-01","87":"2016-01-01","88":"2016-02-01","89":"2016-03-01","90":"2016-04-01","91":"2016-05-01","92":"2016-06-01","93":"2016-07-01","94":"2016-08-01","95":"2016-09-01","96":"2016-10-01"},"Cluster 0":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":0.0,"6":1.0,"7":1.0,"8":1.0,"9":2.0,"10":2.0,"11":2.0,"12":3.0,"13":3.0,"14":4.0,"15":5.0,"16":5.0,"17":6.0,"18":7.0,"19":7.0,"20":8.0,"21":9.0,"22":10.0,"23":10.0,"24":11.0,"25":12.0,"26":13.0,"27":14.0,"28":15.0,"29":16.0,"30":18.0,"31":19.0,"32":20.0,"33":21.0,"34":23.0,"35":24.0,"36":25.0,"37":26.0,"38":28.0,"39":29.0,"40":31.0,"41":33.0,"42":35.0,"43":37.0,"44":39.0,"45":41.0,"46":43.0,"47":45.0,"48":47.0,"49":49.0,"50":52.0,"51":54.0,"52":57.0,"53":60.0,"54":63.0,"55":66.0,"56":69.0,"57":72.0,"58":75.0,"59":78.0,"60":82.0,"61":86.0,"62":89.0,"63":93.0,"64":97.0,"65":102.0,"66":107.0,"67":110.0,"68":113.0,"69":117.0,"70":121.0,"71":124.0,"72":128.0,"73":132.0,"74":136.0,"75":140.0,"76":144.0,"77":149.0,"78":154.0,"79":159.0,"80":163.0,"81":168.0,"82":173.0,"83":177.0,"84":183.0,"85":189.0,"86":194.0,"87":199.0,"88":205.0,"89":212.0,"90":218.0,"91":224.0,"92":230.0,"93":236.0,"94":242.0,"95":248.0,"96":250.0},"Cluster 3":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":1.0,"5":1.0,"6":1.0,"7":2.0,"8":2.0,"9":3.0,"10":3.0,"11":4.0,"12":4.0,"13":5.0,"14":6.0,"15":7.0,"16":8.0,"17":8.0,"18":9.0,"19":10.0,"20":11.0,"21":12.0,"22":13.0,"23":14.0,"24":15.0,"25":16.0,"26":18.0,"27":19.0,"28":20.0,"29":22.0,"30":23.0,"31":24.0,"32":26.0,"33":27.0,"34":29.0,"35":31.0,"36":32.0,"37":34.0,"38":35.0,"39":37.0,"40":39.0,"41":41.0,"42":43.0,"43":44.0,"44":47.0,"45":49.0,"46":51.0,"47":53.0,"48":56.0,"49":58.0,"50":60.0,"51":63.0,"52":65.0,"53":68.0,"54":70.0,"55":73.0,"56":76.0,"57":79.0,"58":82.0,"59":85.0,"60":88.0,"61":91.0,"62":94.0,"63":98.0,"64":101.0,"65":105.0,"66":109.0,"67":112.0,"68":115.0,"69":119.0,"70":122.0,"71":125.0,"72":128.0,"73":132.0,"74":135.0,"75":138.0,"76":142.0,"77":146.0,"78":150.0,"79":154.0,"80":158.0,"81":163.0,"82":167.0,"83":170.0,"84":175.0,"85":179.0,"86":183.0,"87":188.0,"88":193.0,"89":198.0,"90":203.0,"91":208.0,"92":212.0,"93":217.0,"94":222.0,"95":227.0,"96":229.0},"Cluster 2":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":0.0,"6":0.0,"7":0.0,"8":0.0,"9":0.0,"10":1.0,"11":1.0,"12":1.0,"13":1.0,"14":1.0,"15":1.0,"16":2.0,"17":2.0,"18":2.0,"19":2.0,"20":3.0,"21":3.0,"22":3.0,"23":4.0,"24":4.0,"25":4.0,"26":5.0,"27":5.0,"28":5.0,"29":6.0,"30":6.0,"31":7.0,"32":7.0,"33":8.0,"34":8.0,"35":9.0,"36":9.0,"37":10.0,"38":10.0,"39":11.0,"40":11.0,"41":12.0,"42":13.0,"43":13.0,"44":14.0,"45":15.0,"46":16.0,"47":16.0,"48":17.0,"49":18.0,"50":19.0,"51":20.0,"52":21.0,"53":22.0,"54":23.0,"55":24.0,"56":25.0,"57":26.0,"58":27.0,"59":28.0,"60":30.0,"61":31.0,"62":32.0,"63":33.0,"64":35.0,"65":36.0,"66":38.0,"67":39.0,"68":40.0,"69":41.0,"70":43.0,"71":44.0,"72":45.0,"73":47.0,"74":48.0,"75":49.0,"76":51.0,"77":52.0,"78":54.0,"79":55.0,"80":57.0,"81":59.0,"82":61.0,"83":62.0,"84":64.0,"85":66.0,"86":67.0,"87":69.0,"88":71.0,"89":73.0,"90":75.0,"91":77.0,"92":79.0,"93":81.0,"94":83.0,"95":85.0,"96":86.0},"Cluster 4":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":0.0,"6":0.0,"7":0.0,"8":0.0,"9":0.0,"10":0.0,"11":1.0,"12":1.0,"13":1.0,"14":1.0,"15":1.0,"16":1.0,"17":2.0,"18":2.0,"19":2.0,"20":2.0,"21":3.0,"22":3.0,"23":3.0,"24":4.0,"25":4.0,"26":4.0,"27":5.0,"28":5.0,"29":5.0,"30":6.0,"31":6.0,"32":7.0,"33":7.0,"34":7.0,"35":8.0,"36":8.0,"37":9.0,"38":9.0,"39":10.0,"40":10.0,"41":11.0,"42":11.0,"43":12.0,"44":13.0,"45":13.0,"46":14.0,"47":15.0,"48":15.0,"49":16.0,"50":17.0,"51":17.0,"52":18.0,"53":19.0,"54":20.0,"55":21.0,"56":22.0,"57":23.0,"58":24.0,"59":25.0,"60":26.0,"61":27.0,"62":28.0,"63":29.0,"64":30.0,"65":31.0,"66":33.0,"67":34.0,"68":35.0,"69":36.0,"70":37.0,"71":38.0,"72":39.0,"73":40.0,"74":41.0,"75":42.0,"76":44.0,"77":45.0,"78":46.0,"79":48.0,"80":49.0,"81":50.0,"82":52.0,"83":53.0,"84":54.0,"85":56.0,"86":57.0,"87":58.0,"88":60.0,"89":62.0,"90":63.0,"91":65.0,"92":67.0,"93":68.0,"94":70.0,"95":72.0,"96":72.0},"Cluster 1":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":0.0,"6":0.0,"7":0.0,"8":0.0,"9":0.0,"10":0.0,"11":1.0,"12":1.0,"13":1.0,"14":1.0,"15":1.0,"16":2.0,"17":2.0,"18":2.0,"19":2.0,"20":3.0,"21":3.0,"22":3.0,"23":3.0,"24":4.0,"25":4.0,"26":4.0,"27":5.0,"28":5.0,"29":6.0,"30":6.0,"31":6.0,"32":7.0,"33":7.0,"34":8.0,"35":8.0,"36":8.0,"37":9.0,"38":9.0,"39":9.0,"40":10.0,"41":10.0,"42":11.0,"43":11.0,"44":12.0,"45":13.0,"46":13.0,"47":14.0,"48":14.0,"49":15.0,"50":15.0,"51":16.0,"52":16.0,"53":17.0,"54":18.0,"55":19.0,"56":19.0,"57":20.0,"58":21.0,"59":21.0,"60":22.0,"61":23.0,"62":24.0,"63":25.0,"64":26.0,"65":27.0,"66":28.0,"67":29.0,"68":30.0,"69":31.0,"70":32.0,"71":33.0,"72":33.0,"73":34.0,"74":35.0,"75":36.0,"76":37.0,"77":38.0,"78":39.0,"79":40.0,"80":41.0,"81":43.0,"82":44.0,"83":45.0,"84":46.0,"85":47.0,"86":49.0,"87":50.0,"88":51.0,"89":52.0,"90":54.0,"91":55.0,"92":56.0,"93":57.0,"94":59.0,"95":60.0,"96":60.0}}';

	var vis_json_text_absolute = '{"Month-Year":{"0":"2008-10-01","1":"2008-11-01","2":"2008-12-01","3":"2009-01-01","4":"2009-02-01","5":"2009-03-01","6":"2009-04-01","7":"2009-05-01","8":"2009-06-01","9":"2009-07-01","10":"2009-08-01","11":"2009-09-01","12":"2009-10-01","13":"2009-11-01","14":"2009-12-01","15":"2010-01-01","16":"2010-02-01","17":"2010-03-01","18":"2010-04-01","19":"2010-05-01","20":"2010-06-01","21":"2010-07-01","22":"2010-08-01","23":"2010-09-01","24":"2010-10-01","25":"2010-11-01","26":"2010-12-01","27":"2011-01-01","28":"2011-02-01","29":"2011-03-01","30":"2011-04-01","31":"2011-05-01","32":"2011-06-01","33":"2011-07-01","34":"2011-08-01","35":"2011-09-01","36":"2011-10-01","37":"2011-11-01","38":"2011-12-01","39":"2012-01-01","40":"2012-02-01","41":"2012-03-01","42":"2012-04-01","43":"2012-05-01","44":"2012-06-01","45":"2012-07-01","46":"2012-08-01","47":"2012-09-01","48":"2012-10-01","49":"2012-11-01","50":"2012-12-01","51":"2013-01-01","52":"2013-02-01","53":"2013-03-01","54":"2013-04-01","55":"2013-05-01","56":"2013-06-01","57":"2013-07-01","58":"2013-08-01","59":"2013-09-01","60":"2013-10-01","61":"2013-11-01","62":"2013-12-01","63":"2014-01-01","64":"2014-02-01","65":"2014-03-01","66":"2014-04-01","67":"2014-05-01","68":"2014-06-01","69":"2014-07-01","70":"2014-08-01","71":"2014-09-01","72":"2014-10-01","73":"2014-11-01","74":"2014-12-01","75":"2015-01-01","76":"2015-02-01","77":"2015-03-01","78":"2015-04-01","79":"2015-05-01","80":"2015-06-01","81":"2015-07-01","82":"2015-08-01","83":"2015-09-01","84":"2015-10-01","85":"2015-11-01","86":"2015-12-01","87":"2016-01-01","88":"2016-02-01","89":"2016-03-01","90":"2016-04-01","91":"2016-05-01","92":"2016-06-01","93":"2016-07-01","94":"2016-08-01","95":"2016-09-01","96":"2016-10-01"},"Cluster 0":{"0":78.0,"1":181.0,"2":298.0,"3":472.0,"4":637.0,"5":831.0,"6":1037.0,"7":1332.0,"8":1611.0,"9":1889.0,"10":2207.0,"11":2545.0,"12":2939.0,"13":3392.0,"14":3817.0,"15":4390.0,"16":4950.0,"17":5551.0,"18":6092.0,"19":6648.0,"20":7259.0,"21":7998.0,"22":8688.0,"23":9296.0,"24":10108.0,"25":10899.0,"26":11601.0,"27":12446.0,"28":13318.0,"29":14503.0,"30":15518.0,"31":16561.0,"32":17595.0,"33":18679.0,"34":19842.0,"35":20898.0,"36":22056.0,"37":23230.0,"38":24355.0,"39":25662.0,"40":27147.0,"41":28768.0,"42":30339.0,"43":31993.0,"44":33664.0,"45":35414.0,"46":37168.0,"47":38864.0,"48":40883.0,"49":42946.0,"50":44800.0,"51":46907.0,"52":49167.0,"53":51688.0,"54":54419.0,"55":57037.0,"56":59551.0,"57":62522.0,"58":65101.0,"59":67823.0,"60":71323.0,"61":74624.0,"62":77446.0,"63":80797.0,"64":84167.0,"65":88291.0,"66":92241.0,"67":95276.0,"68":98162.0,"69":101524.0,"70":104487.0,"71":107428.0,"72":110744.0,"73":114183.0,"74":117375.0,"75":120750.0,"76":124422.0,"77":128697.0,"78":132848.0,"79":136967.0,"80":141001.0,"81":145370.0,"82":149254.0,"83":153173.0,"84":158045.0,"85":162922.0,"86":167232.0,"87":171910.0,"88":177090.0,"89":182678.0,"90":188175.0,"91":193295.0,"92":198458.0,"93":203601.0,"94":208625.0,"95":213689.0,"96":215851.0},"Cluster 3":{"0":112.0,"1":303.0,"2":473.0,"3":714.0,"4":969.0,"5":1274.0,"6":1588.0,"7":1946.0,"8":2346.0,"9":2822.0,"10":3271.0,"11":3721.0,"12":4272.0,"13":4881.0,"14":5504.0,"15":6260.0,"16":6913.0,"17":7693.0,"18":8395.0,"19":9166.0,"20":9973.0,"21":10922.0,"22":11838.0,"23":12696.0,"24":13637.0,"25":14594.0,"26":15524.0,"27":16560.0,"28":17697.0,"29":19022.0,"30":20260.0,"31":21505.0,"32":22752.0,"33":24076.0,"34":25489.0,"35":26769.0,"36":28002.0,"37":29366.0,"38":30647.0,"39":32100.0,"40":33632.0,"41":35338.0,"42":37034.0,"43":38729.0,"44":40541.0,"45":42490.0,"46":44589.0,"47":46305.0,"48":48284.0,"49":50376.0,"50":52274.0,"51":54391.0,"52":56531.0,"53":58803.0,"54":61094.0,"55":63454.0,"56":65807.0,"57":68437.0,"58":70944.0,"59":73454.0,"60":76240.0,"61":78970.0,"62":81492.0,"63":84434.0,"64":87426.0,"65":90790.0,"66":93964.0,"67":96673.0,"68":99434.0,"69":102506.0,"70":105342.0,"71":108114.0,"72":111084.0,"73":113948.0,"74":116665.0,"75":119698.0,"76":122843.0,"77":126290.0,"78":129646.0,"79":132969.0,"80":136618.0,"81":140402.0,"82":143864.0,"83":147190.0,"84":151057.0,"85":154800.0,"86":158444.0,"87":162348.0,"88":166623.0,"89":170937.0,"90":175150.0,"91":179193.0,"92":183292.0,"93":187440.0,"94":191816.0,"95":195908.0,"96":197567.0},"Cluster 2":{"0":26.0,"1":69.0,"2":118.0,"3":177.0,"4":237.0,"5":318.0,"6":382.0,"7":501.0,"8":615.0,"9":737.0,"10":863.0,"11":963.0,"12":1132.0,"13":1304.0,"14":1476.0,"15":1659.0,"16":1837.0,"17":2068.0,"18":2258.0,"19":2514.0,"20":2780.0,"21":3099.0,"22":3390.0,"23":3628.0,"24":3920.0,"25":4194.0,"26":4456.0,"27":4768.0,"28":5077.0,"29":5470.0,"30":5836.0,"31":6219.0,"32":6612.0,"33":7017.0,"34":7439.0,"35":7822.0,"36":8240.0,"37":8715.0,"38":9122.0,"39":9583.0,"40":10108.0,"41":10710.0,"42":11311.0,"43":11949.0,"44":12594.0,"45":13335.0,"46":13989.0,"47":14550.0,"48":15255.0,"49":16049.0,"50":16664.0,"51":17398.0,"52":18171.0,"53":19109.0,"54":20123.0,"55":21079.0,"56":22021.0,"57":23139.0,"58":24071.0,"59":24945.0,"60":26017.0,"61":27105.0,"62":28005.0,"63":29097.0,"64":30272.0,"65":31660.0,"66":32905.0,"67":33989.0,"68":34933.0,"69":36091.0,"70":37234.0,"71":38289.0,"72":39445.0,"73":40645.0,"74":41729.0,"75":42842.0,"76":44081.0,"77":45525.0,"78":46977.0,"79":48211.0,"80":49725.0,"81":51204.0,"82":52553.0,"83":53797.0,"84":55415.0,"85":57041.0,"86":58517.0,"87":60074.0,"88":61771.0,"89":63534.0,"90":65320.0,"91":66991.0,"92":68616.0,"93":70346.0,"94":72085.0,"95":73722.0,"96":74453.0},"Cluster 4":{"0":26.0,"1":74.0,"2":120.0,"3":185.0,"4":232.0,"5":297.0,"6":371.0,"7":457.0,"8":566.0,"9":663.0,"10":763.0,"11":889.0,"12":1008.0,"13":1140.0,"14":1301.0,"15":1491.0,"16":1683.0,"17":1871.0,"18":2049.0,"19":2258.0,"20":2467.0,"21":2729.0,"22":3010.0,"23":3264.0,"24":3578.0,"25":3844.0,"26":4099.0,"27":4390.0,"28":4683.0,"29":5070.0,"30":5382.0,"31":5773.0,"32":6110.0,"33":6496.0,"34":6878.0,"35":7238.0,"36":7634.0,"37":8046.0,"38":8446.0,"39":8926.0,"40":9370.0,"41":9850.0,"42":10306.0,"43":10808.0,"44":11375.0,"45":11977.0,"46":12561.0,"47":13067.0,"48":13627.0,"49":14198.0,"50":14792.0,"51":15497.0,"52":16157.0,"53":16970.0,"54":17753.0,"55":18569.0,"56":19285.0,"57":20090.0,"58":20849.0,"59":21624.0,"60":22488.0,"61":23415.0,"62":24324.0,"63":25284.0,"64":26244.0,"65":27428.0,"66":28570.0,"67":29510.0,"68":30442.0,"69":31512.0,"70":32494.0,"71":33330.0,"72":34270.0,"73":35204.0,"74":36051.0,"75":37022.0,"76":37997.0,"77":39142.0,"78":40275.0,"79":41474.0,"80":42650.0,"81":43804.0,"82":44911.0,"83":45930.0,"84":47084.0,"85":48321.0,"86":49503.0,"87":50800.0,"88":52191.0,"89":53679.0,"90":55086.0,"91":56593.0,"92":57910.0,"93":59340.0,"94":60753.0,"95":62038.0,"96":62647.0},"Cluster 1":{"0":29.0,"1":69.0,"2":107.0,"3":169.0,"4":234.0,"5":320.0,"6":402.0,"7":504.0,"8":592.0,"9":734.0,"10":851.0,"11":977.0,"12":1115.0,"13":1273.0,"14":1435.0,"15":1633.0,"16":1873.0,"17":2095.0,"18":2267.0,"19":2455.0,"20":2714.0,"21":2959.0,"22":3199.0,"23":3435.0,"24":3674.0,"25":3931.0,"26":4202.0,"27":4548.0,"28":4890.0,"29":5259.0,"30":5594.0,"31":5928.0,"32":6282.0,"33":6636.0,"34":6961.0,"35":7285.0,"36":7604.0,"37":7936.0,"38":8222.0,"39":8593.0,"40":8984.0,"41":9445.0,"42":9885.0,"43":10324.0,"44":10760.0,"45":11239.0,"46":11761.0,"47":12219.0,"48":12679.0,"49":13132.0,"50":13556.0,"51":14065.0,"52":14610.0,"53":15185.0,"54":15824.0,"55":16383.0,"56":16972.0,"57":17575.0,"58":18232.0,"59":18856.0,"60":19616.0,"61":20437.0,"62":21116.0,"63":21996.0,"64":22775.0,"65":23694.0,"66":24518.0,"67":25259.0,"68":26079.0,"69":26911.0,"70":27707.0,"71":28455.0,"72":29253.0,"73":30018.0,"74":30792.0,"75":31612.0,"76":32416.0,"77":33320.0,"78":34208.0,"79":35111.0,"80":36106.0,"81":37175.0,"82":38214.0,"83":39248.0,"84":40253.0,"85":41233.0,"86":42235.0,"87":43336.0,"88":44486.0,"89":45642.0,"90":46689.0,"91":47737.0,"92":48771.0,"93":49778.0,"94":50888.0,"95":51945.0,"96":52351.0}}';

	var vis_json = JSON.parse(vis_json_text);
	var vis_json_absolute = JSON.parse(vis_json_text_absolute);

	// Run function periodically to make things move.
	var timeout;
	var starting = 0;
	var nodesArrayIndex = 0;

	var total_count = 0;

	var total_count_yoy = 0;

	var month_year = vis_json["Month-Year"];
	var clusters = {
		0: vis_json["Cluster 0"],
		1: vis_json["Cluster 1"],
		2: vis_json["Cluster 2"],
		3: vis_json["Cluster 3"],
		4: vis_json["Cluster 4"],
	};
	var clusters_absolute = {
		0: vis_json_absolute["Cluster 0"],
		1: vis_json_absolute["Cluster 1"],
		2: vis_json_absolute["Cluster 2"],
		3: vis_json_absolute["Cluster 3"],
		4: vis_json_absolute["Cluster 4"],
	};

	var month = {
		"01": "Jan",
		"02": "Feb",
		"03": "Mar",
		"04": "Apr",
		"05": "May",
		"06": "Jun",
		"07": "Jul",
		"08": "Aug",
		"09": "Sep",
		"10": "Oct",
		"11": "Nov",
		"12": "Dec",
	};

	function timer() {

		var total_count_before = total_count;

		var index;
		for(index = 0; index < d3.keys(clusters).length; index++) {

			var curr_cluster = clusters[index];
			var curr_cluster_absolute = clusters_absolute[index];
			var nested_index;
			var choice = d3.keys(foci)[index];

			if(starting == 0) {

				for(nested_index = 0; nested_index < curr_cluster[starting]; nested_index++) {
					nodes[nodesArrayIndex].cx = foci[choice].x;
				    nodes[nodesArrayIndex].cy = foci[choice].y;
				    nodes[nodesArrayIndex].choice = choice;
				    nodesArrayIndex = nodesArrayIndex + 1;   
				}

				var counts = curr_cluster_absolute[starting];
				cluster_counts[String(index)] += counts;

			}

			else {

				var difference = curr_cluster[starting] - curr_cluster[starting-1];
				for(nested_index = 0; nested_index < difference; nested_index++) {
					nodes[nodesArrayIndex].cx = foci[choice].x;
				    nodes[nodesArrayIndex].cy = foci[choice].y;
				    nodes[nodesArrayIndex].choice = choice;
				    nodesArrayIndex = nodesArrayIndex + 1;   
				}

				var counts = curr_cluster_absolute[starting] - curr_cluster_absolute[starting-1];
				var yoy = counts/curr_cluster_absolute[starting-1];

				cluster_counts[String(index)] += counts;
				cluster_yoy[String(index)] = yoy;

			}

			total_count += counts;

		}

		if(total_count_before != 0) total_count_yoy = (total_count - total_count_before)/total_count_before;

		d3.select("#current_time").text(month[month_year[starting].split("-")[1]] + " " + month_year[starting].split("-")[0]);

		starting++;

		label.selectAll("tspan.num")
			.text(function(d) {
				return "[" + cluster_counts[d.index] + ", " + 
				readablePercent(cluster_counts[d.index]/total_count) + ", " +
				readableChange(cluster_yoy[d.index]) + "]";
			});

		d3.select("#total_num_bottom")
			.text(function(d) {
				return String(total_count) + ", " + readableChange(total_count_yoy);
			});
	    
	    force.resume();
	    
	    // Run it again in a few seconds.
	    if(starting <= 96) timeout = setTimeout(timer, speeds[USER_SPEED]);
	}

	timeout = setTimeout(timer, speeds[USER_SPEED]);

	//
	// Force-directed boiler plate functions
	//

	function tick(e) {
		circle
		.each(gravity(.051 * e.alpha))
	  	.each(collide(.5))
	  	.style("fill", function(d) { return foci[d.choice].color; })
	    .attr("cx", function(d) { return d.x; })
	    .attr("cy", function(d) { return d.y; });
	}


	// Move nodes toward cluster focus.
	function gravity(alpha) {
		return function(d) {
			d.y += (foci[d.choice].y - d.y) * alpha;
			d.x += (foci[d.choice].x - d.x) * alpha;
		};
	}

	// Resolve collisions between nodes.
	function collide(alpha) {
		var quadtree = d3.geom.quadtree(nodes);
		return function(d) {
			var r = d.radius + node_radius + Math.max(padding, cluster_padding),
	        nx1 = d.x - r,
	        nx2 = d.x + r,
	        ny1 = d.y - r,
	        ny2 = d.y + r;
	        quadtree.visit(function(quad, x1, y1, x2, y2) {
	         	if (quad.point && (quad.point !== d)) {
	         		var x = d.x - quad.point.x,
	         		y = d.y - quad.point.y,
	         		l = Math.sqrt(x * x + y * y),
	         		r = d.radius + quad.point.radius + (d.choice === quad.point.choice ? padding : cluster_padding);
	         		if (l < r) {
	         			l = (l - r) / l * alpha;
	         			d.x -= x *= l;
	         			d.y -= y *= l;
	         			quad.point.x += x;
	         			quad.point.y += y;
	         		}
	         	}
	         return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
	        })
	    };
	}

	d3.selectAll(".togglebutton")
      .on("click", function() {
        if (d3.select(this).attr("data-val") == "slow") {
            d3.select(".slow").classed("current", true);
			d3.select(".medium").classed("current", false);
            d3.select(".fast").classed("current", false);
        } else if (d3.select(this).attr("data-val") == "medium") {
            d3.select(".slow").classed("current", false);
			d3.select(".medium").classed("current", true);
            d3.select(".fast").classed("current", false);
        } 
		else {
            d3.select(".slow").classed("current", false);
			d3.select(".medium").classed("current", false);
			d3.select(".fast").classed("current", true);
        }
		
		USER_SPEED = d3.select(this).attr("data-val");
    });

    // Output readable percent based on count.
	function readablePercent(n) {
	
		var pct;
		if (n < 0.01) {
			pct = "<1%";
		} else {
			pct = (n * 100).toFixed(1) + "%";
		}
	
		return pct;
	}

	function readableChange(n) {

		var change;
		if (n < 0) {
			change = "-" + readablePercent(n);
		}
		else if (n == 0) {
			change = "0.0%";
		}
		else {
			if(readablePercent(n) != "<1%") change = "+" + readablePercent(n);
			else change = readablePercent(n);
		}
		return change;

	}

	</script>

</body>