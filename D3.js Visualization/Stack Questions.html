<!DOCTYPE html>

<head>
	<title>Clustering Simulation - Stack Questions</title>
	<link rel="stylesheet" href="style.css" type="text/css" media="screen"/>
</head>

<meta charset="utf-8">
<style>.node{stroke-width:1.5px;}</style>

<body style="background-color:black;">

	<div id="main-wrapper">

	<div id="note"></div>

	</div>
	<div id="chart1"></div>
	<div class="clr"></div>
	</div>

	<div id="speed">
	<div class="togglebutton slow" data-val="slow">Slow</div>
	<div class="togglebutton medium current" data-val="medium">Medium</div>
	<div class="togglebutton fast" data-val="fast">Fast</div>
	<div class="clr"></div>
	</div>

	<div id="current_time">Month-Year</div>

	<div id="total_num_top">Total Questions:</div>
	<div id="total_num_bottom">0, 0%</div>

	<div id="chart2"></div>
	<div class="clr"></div>

	<script src="d3.js/d3-3-5-5.min.js"></script>

	<script>

	var USER_SPEED = "medium";

	var speeds = { "slow": 1000, "medium": 200, "fast": 50 };

	var width = 700,
    	height = 700;

	var node_radius = 3.5,
	    padding = 1,
	    cluster_padding = 10,
	    num_nodes = 700;   

	var svg = d3.select("#chart1").append("svg")
    	.attr("width", width)
    	.attr("height", height)
    	.append("g")

	// Foci
	var foci = {
		"center": { x: 350, y: 340, color: "#AFAFB0" },
		0: { x: 350, y: 100, color: "#357C4C" }, 
		1: { x: 590, y: 340, color: "#B91E68" }, 
		2: { x: 470, y: 547.847, color: "#8A5031" },
		3: { x: 230, y: 547.847, color: "#EE5145" },
		4: { x: 110, y: 340, color: "#5F4C86" },
	};

	var cluster_codes = [
		{"index": "0", "name": "General Programming", "tag": "(Memory, Algorithm, Pointer)"},
		{"index": "1", "name": "Back-End Development", "tag": "(App, Server, Connection)"},
		{"index": "2", "name": "Database Manipulation", "tag": "(Database, Query, Table)"},
		{"index": "3", "name": "Front-End Development", "tag": "(Button, Image, Position)"},
		{"index": "4", "name": "Utility", "tag": "(Interface, Path, Eclipse)"},
	];

	var cluster_counts = { "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 0};
	var cluster_yoy = { "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 0};

	// Create node objects
	var nodes = d3.range(0, num_nodes).map(function(o, i) {
		return {
			id: "node" + i,
			x: foci.center.x + Math.random(),
			y: foci.center.y + Math.random(),
			radius: node_radius,
			choice: "center",
		}
	});

	// Force-directed layout
	var force = d3.layout.force()
		.nodes(nodes)
		.size([width, height])
		.gravity(0)
		.charge(0)
		.friction(.91)
		.on("tick", tick)
		.start();
	    
	// Draw circle for each node.
	var circle = svg.selectAll("circle")
		.data(nodes)
	    .enter().append("circle")
		.attr("id", function(d) { return d.id; })
		.attr("class", "node")
		.style("fill", function(d) { return foci[d.choice].color; });

	// Labels

	var label = svg.selectAll("text")
		.data(cluster_codes)
	    .enter().append("text")
		.attr("class", "cluster_label")
		.attr("x", function(d, i) {
			var cluster_index = Number(d.index);
			return foci[cluster_index].x;
		})
		.attr("y", function(d, i) {
			var cluster_index = Number(d.index);
			return foci[cluster_index].y;		
		});
		
	label.append("tspan")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("fill", "#FFFFFF")
		.attr("font-size", "21px")
		.text(function(d) {
			return d.name;
		});

	label.append("tspan")
		.attr("dy", "1.1em")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("fill", "#FFFFFF")
		.attr("font-size", "12px")
		.text(function(d) {
			return d.tag;
		});

	label.append("tspan")
		.attr("dy", "1.2em")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("font-size", "13px")
		.attr("class", "num")
		.attr("fill", "#FFFFFF")
		.text(function(d) {
			return "[" + cluster_counts[d.index] + ", " + "<1%" + ", " + 
			readableChange(cluster_yoy[d.index]) + "]";
		});

	// For smoother initial transition to settling spots.
	circle.transition()
		.duration(900)
		.delay(function(d,i) { return i * 5; })
		.attrTween("r", function(d) {
			var i = d3.interpolate(0, d.radius);
			return function(t) { return d.radius = i(t); };
		});

	var exact_num = 1255956;

	var vis_json_text = '{"Month-Year":{"0":"2008-10-01","1":"2008-11-01","2":"2008-12-01","3":"2009-01-01","4":"2009-02-01","5":"2009-03-01","6":"2009-04-01","7":"2009-05-01","8":"2009-06-01","9":"2009-07-01","10":"2009-08-01","11":"2009-09-01","12":"2009-10-01","13":"2009-11-01","14":"2009-12-01","15":"2010-01-01","16":"2010-02-01","17":"2010-03-01","18":"2010-04-01","19":"2010-05-01","20":"2010-06-01","21":"2010-07-01","22":"2010-08-01","23":"2010-09-01","24":"2010-10-01","25":"2010-11-01","26":"2010-12-01","27":"2011-01-01","28":"2011-02-01","29":"2011-03-01","30":"2011-04-01","31":"2011-05-01","32":"2011-06-01","33":"2011-07-01","34":"2011-08-01","35":"2011-09-01","36":"2011-10-01","37":"2011-11-01","38":"2011-12-01","39":"2012-01-01","40":"2012-02-01","41":"2012-03-01","42":"2012-04-01","43":"2012-05-01","44":"2012-06-01","45":"2012-07-01","46":"2012-08-01","47":"2012-09-01","48":"2012-10-01","49":"2012-11-01","50":"2012-12-01","51":"2013-01-01","52":"2013-02-01","53":"2013-03-01","54":"2013-04-01","55":"2013-05-01","56":"2013-06-01","57":"2013-07-01","58":"2013-08-01","59":"2013-09-01","60":"2013-10-01","61":"2013-11-01","62":"2013-12-01","63":"2014-01-01","64":"2014-02-01","65":"2014-03-01","66":"2014-04-01","67":"2014-05-01","68":"2014-06-01","69":"2014-07-01","70":"2014-08-01","71":"2014-09-01","72":"2014-10-01","73":"2014-11-01","74":"2014-12-01","75":"2015-01-01","76":"2015-02-01","77":"2015-03-01","78":"2015-04-01","79":"2015-05-01","80":"2015-06-01","81":"2015-07-01","82":"2015-08-01","83":"2015-09-01","84":"2015-10-01","85":"2015-11-01","86":"2015-12-01","87":"2016-01-01","88":"2016-02-01","89":"2016-03-01","90":"2016-04-01","91":"2016-05-01","92":"2016-06-01","93":"2016-07-01","94":"2016-08-01","95":"2016-09-01","96":"2016-10-01"},"Cluster 1":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":1.0,"5":1.0,"6":1.0,"7":2.0,"8":2.0,"9":3.0,"10":3.0,"11":4.0,"12":5.0,"13":5.0,"14":6.0,"15":7.0,"16":8.0,"17":9.0,"18":10.0,"19":11.0,"20":12.0,"21":13.0,"22":14.0,"23":15.0,"24":16.0,"25":18.0,"26":19.0,"27":20.0,"28":22.0,"29":24.0,"30":26.0,"31":28.0,"32":30.0,"33":32.0,"34":34.0,"35":36.0,"36":38.0,"37":40.0,"38":42.0,"39":44.0,"40":46.0,"41":49.0,"42":52.0,"43":54.0,"44":57.0,"45":60.0,"46":62.0,"47":65.0,"48":68.0,"49":71.0,"50":73.0,"51":76.0,"52":79.0,"53":83.0,"54":86.0,"55":89.0,"56":92.0,"57":95.0,"58":99.0,"59":102.0,"60":105.0,"61":109.0,"62":112.0,"63":115.0,"64":119.0,"65":123.0,"66":127.0,"67":130.0,"68":133.0,"69":137.0,"70":140.0,"71":143.0,"72":147.0,"73":150.0,"74":153.0,"75":156.0,"76":160.0,"77":164.0,"78":167.0,"79":171.0,"80":175.0,"81":179.0,"82":182.0,"83":186.0,"84":190.0,"85":194.0,"86":198.0,"87":202.0,"88":207.0,"89":212.0,"90":216.0,"91":221.0,"92":225.0,"93":229.0,"94":234.0,"95":238.0,"96":240.0},"Cluster 3":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":0.0,"6":1.0,"7":1.0,"8":1.0,"9":2.0,"10":2.0,"11":3.0,"12":3.0,"13":4.0,"14":4.0,"15":5.0,"16":6.0,"17":6.0,"18":7.0,"19":8.0,"20":9.0,"21":10.0,"22":11.0,"23":12.0,"24":13.0,"25":14.0,"26":15.0,"27":16.0,"28":17.0,"29":19.0,"30":20.0,"31":22.0,"32":24.0,"33":25.0,"34":27.0,"35":29.0,"36":30.0,"37":32.0,"38":34.0,"39":36.0,"40":38.0,"41":40.0,"42":42.0,"43":44.0,"44":47.0,"45":49.0,"46":51.0,"47":53.0,"48":56.0,"49":58.0,"50":61.0,"51":63.0,"52":66.0,"53":69.0,"54":71.0,"55":74.0,"56":77.0,"57":80.0,"58":83.0,"59":85.0,"60":88.0,"61":91.0,"62":94.0,"63":97.0,"64":100.0,"65":104.0,"66":107.0,"67":110.0,"68":112.0,"69":115.0,"70":118.0,"71":120.0,"72":123.0,"73":125.0,"74":128.0,"75":130.0,"76":133.0,"77":136.0,"78":139.0,"79":142.0,"80":144.0,"81":147.0,"82":150.0,"83":153.0,"84":156.0,"85":159.0,"86":162.0,"87":165.0,"88":168.0,"89":171.0,"90":175.0,"91":178.0,"92":181.0,"93":184.0,"94":187.0,"95":190.0,"96":191.0},"Cluster 0":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":1.0,"6":1.0,"7":1.0,"8":1.0,"9":2.0,"10":2.0,"11":3.0,"12":3.0,"13":3.0,"14":4.0,"15":4.0,"16":5.0,"17":5.0,"18":6.0,"19":6.0,"20":7.0,"21":8.0,"22":8.0,"23":9.0,"24":10.0,"25":10.0,"26":11.0,"27":12.0,"28":13.0,"29":14.0,"30":15.0,"31":16.0,"32":17.0,"33":18.0,"34":19.0,"35":20.0,"36":21.0,"37":22.0,"38":23.0,"39":24.0,"40":25.0,"41":26.0,"42":28.0,"43":29.0,"44":30.0,"45":32.0,"46":33.0,"47":34.0,"48":36.0,"49":38.0,"50":39.0,"51":40.0,"52":42.0,"53":44.0,"54":46.0,"55":47.0,"56":49.0,"57":51.0,"58":52.0,"59":54.0,"60":56.0,"61":58.0,"62":60.0,"63":62.0,"64":64.0,"65":66.0,"66":68.0,"67":70.0,"68":71.0,"69":73.0,"70":75.0,"71":77.0,"72":79.0,"73":81.0,"74":82.0,"75":84.0,"76":86.0,"77":88.0,"78":90.0,"79":92.0,"80":94.0,"81":96.0,"82":98.0,"83":100.0,"84":102.0,"85":105.0,"86":107.0,"87":109.0,"88":111.0,"89":114.0,"90":116.0,"91":118.0,"92":121.0,"93":123.0,"94":125.0,"95":127.0,"96":128.0},"Cluster 2":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":0.0,"6":0.0,"7":0.0,"8":1.0,"9":1.0,"10":1.0,"11":1.0,"12":1.0,"13":2.0,"14":2.0,"15":2.0,"16":2.0,"17":3.0,"18":3.0,"19":3.0,"20":4.0,"21":4.0,"22":5.0,"23":5.0,"24":5.0,"25":6.0,"26":6.0,"27":7.0,"28":7.0,"29":8.0,"30":8.0,"31":9.0,"32":10.0,"33":10.0,"34":11.0,"35":11.0,"36":12.0,"37":13.0,"38":13.0,"39":14.0,"40":15.0,"41":15.0,"42":16.0,"43":17.0,"44":18.0,"45":19.0,"46":20.0,"47":20.0,"48":21.0,"49":22.0,"50":23.0,"51":24.0,"52":25.0,"53":26.0,"54":27.0,"55":28.0,"56":29.0,"57":30.0,"58":31.0,"59":32.0,"60":33.0,"61":34.0,"62":35.0,"63":36.0,"64":37.0,"65":39.0,"66":40.0,"67":41.0,"68":42.0,"69":43.0,"70":44.0,"71":45.0,"72":46.0,"73":47.0,"74":48.0,"75":49.0,"76":50.0,"77":51.0,"78":52.0,"79":53.0,"80":54.0,"81":55.0,"82":57.0,"83":58.0,"84":59.0,"85":60.0,"86":61.0,"87":62.0,"88":63.0,"89":65.0,"90":66.0,"91":67.0,"92":68.0,"93":69.0,"94":71.0,"95":72.0,"96":72.0},"Cluster 4":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":0.0,"6":0.0,"7":1.0,"8":1.0,"9":1.0,"10":1.0,"11":2.0,"12":2.0,"13":2.0,"14":2.0,"15":3.0,"16":3.0,"17":3.0,"18":4.0,"19":4.0,"20":5.0,"21":5.0,"22":5.0,"23":6.0,"24":6.0,"25":7.0,"26":7.0,"27":8.0,"28":8.0,"29":9.0,"30":9.0,"31":10.0,"32":10.0,"33":11.0,"34":12.0,"35":12.0,"36":13.0,"37":13.0,"38":14.0,"39":15.0,"40":15.0,"41":16.0,"42":17.0,"43":17.0,"44":18.0,"45":19.0,"46":20.0,"47":20.0,"48":21.0,"49":22.0,"50":23.0,"51":23.0,"52":24.0,"53":25.0,"54":26.0,"55":27.0,"56":28.0,"57":29.0,"58":30.0,"59":30.0,"60":31.0,"61":32.0,"62":33.0,"63":34.0,"64":35.0,"65":36.0,"66":37.0,"67":38.0,"68":39.0,"69":40.0,"70":40.0,"71":41.0,"72":42.0,"73":43.0,"74":44.0,"75":45.0,"76":46.0,"77":46.0,"78":47.0,"79":48.0,"80":49.0,"81":50.0,"82":51.0,"83":52.0,"84":53.0,"85":54.0,"86":55.0,"87":56.0,"88":57.0,"89":59.0,"90":60.0,"91":61.0,"92":62.0,"93":63.0,"94":64.0,"95":65.0,"96":66.0}}';

	var vis_json_text_absolute = '{"Month-Year":{"0":"2008-10-01","1":"2008-11-01","2":"2008-12-01","3":"2009-01-01","4":"2009-02-01","5":"2009-03-01","6":"2009-04-01","7":"2009-05-01","8":"2009-06-01","9":"2009-07-01","10":"2009-08-01","11":"2009-09-01","12":"2009-10-01","13":"2009-11-01","14":"2009-12-01","15":"2010-01-01","16":"2010-02-01","17":"2010-03-01","18":"2010-04-01","19":"2010-05-01","20":"2010-06-01","21":"2010-07-01","22":"2010-08-01","23":"2010-09-01","24":"2010-10-01","25":"2010-11-01","26":"2010-12-01","27":"2011-01-01","28":"2011-02-01","29":"2011-03-01","30":"2011-04-01","31":"2011-05-01","32":"2011-06-01","33":"2011-07-01","34":"2011-08-01","35":"2011-09-01","36":"2011-10-01","37":"2011-11-01","38":"2011-12-01","39":"2012-01-01","40":"2012-02-01","41":"2012-03-01","42":"2012-04-01","43":"2012-05-01","44":"2012-06-01","45":"2012-07-01","46":"2012-08-01","47":"2012-09-01","48":"2012-10-01","49":"2012-11-01","50":"2012-12-01","51":"2013-01-01","52":"2013-02-01","53":"2013-03-01","54":"2013-04-01","55":"2013-05-01","56":"2013-06-01","57":"2013-07-01","58":"2013-08-01","59":"2013-09-01","60":"2013-10-01","61":"2013-11-01","62":"2013-12-01","63":"2014-01-01","64":"2014-02-01","65":"2014-03-01","66":"2014-04-01","67":"2014-05-01","68":"2014-06-01","69":"2014-07-01","70":"2014-08-01","71":"2014-09-01","72":"2014-10-01","73":"2014-11-01","74":"2014-12-01","75":"2015-01-01","76":"2015-02-01","77":"2015-03-01","78":"2015-04-01","79":"2015-05-01","80":"2015-06-01","81":"2015-07-01","82":"2015-08-01","83":"2015-09-01","84":"2015-10-01","85":"2015-11-01","86":"2015-12-01","87":"2016-01-01","88":"2016-02-01","89":"2016-03-01","90":"2016-04-01","91":"2016-05-01","92":"2016-06-01","93":"2016-07-01","94":"2016-08-01","95":"2016-09-01","96":"2016-10-01"},"Cluster 1":{"0":236.0,"1":614.0,"2":966.0,"3":1476.0,"4":2040.0,"5":2682.0,"6":3310.0,"7":4124.0,"8":5040.0,"9":6038.0,"10":7128.0,"11":8160.0,"12":9312.0,"13":10539.0,"14":11747.0,"15":13228.0,"16":14736.0,"17":16442.0,"18":18028.0,"19":19790.0,"20":21585.0,"21":23616.0,"22":25747.0,"23":27843.0,"24":29965.0,"25":32373.0,"26":34888.0,"27":37605.0,"28":40447.0,"29":43875.0,"30":47131.0,"31":50621.0,"32":53994.0,"33":57452.0,"34":61222.0,"35":64756.0,"36":68270.0,"37":72009.0,"38":75715.0,"39":79773.0,"40":84092.0,"41":88831.0,"42":93461.0,"43":98220.0,"44":102726.0,"45":107801.0,"46":112777.0,"47":117435.0,"48":122718.0,"49":127718.0,"50":132379.0,"51":137899.0,"52":143178.0,"53":149146.0,"54":155006.0,"55":160723.0,"56":166033.0,"57":172081.0,"58":177826.0,"59":183470.0,"60":189642.0,"61":195586.0,"62":201213.0,"63":207815.0,"64":214340.0,"65":221540.0,"66":228178.0,"67":234308.0,"68":240115.0,"69":246464.0,"70":252289.0,"71":258229.0,"72":264279.0,"73":270140.0,"74":275582.0,"75":281548.0,"76":287577.0,"77":294307.0,"78":301092.0,"79":307743.0,"80":314575.0,"81":321617.0,"82":328155.0,"83":334590.0,"84":341899.0,"85":349369.0,"86":356601.0,"87":364177.0,"88":372054.0,"89":380440.0,"90":388748.0,"91":396871.0,"92":404784.0,"93":412307.0,"94":420203.0,"95":428040.0,"96":431376.0},"Cluster 3":{"0":131.0,"1":391.0,"2":656.0,"3":971.0,"4":1345.0,"5":1793.0,"6":2274.0,"7":2866.0,"8":3529.0,"9":4331.0,"10":5097.0,"11":5889.0,"12":6760.0,"13":7703.0,"14":8681.0,"15":9812.0,"16":10973.0,"17":12353.0,"18":13754.0,"19":15169.0,"20":16688.0,"21":18373.0,"22":20119.0,"23":21798.0,"24":23533.0,"25":25421.0,"26":27325.0,"27":29549.0,"28":31863.0,"29":34700.0,"30":37489.0,"31":40451.0,"32":43401.0,"33":46407.0,"34":49635.0,"35":52548.0,"36":55472.0,"37":58704.0,"38":61795.0,"39":65198.0,"40":68783.0,"41":72661.0,"42":76564.0,"43":80694.0,"44":84579.0,"45":88840.0,"46":93004.0,"47":96858.0,"48":101262.0,"49":105578.0,"50":109629.0,"51":114286.0,"52":118752.0,"53":123929.0,"54":129083.0,"55":133930.0,"56":138743.0,"57":144039.0,"58":149150.0,"59":154082.0,"60":159522.0,"61":164732.0,"62":169528.0,"63":174969.0,"64":180568.0,"65":186635.0,"66":192149.0,"67":197383.0,"68":202067.0,"69":207207.0,"70":211817.0,"71":216457.0,"72":221303.0,"73":225773.0,"74":230075.0,"75":234729.0,"76":239284.0,"77":244518.0,"78":249671.0,"79":254845.0,"80":259991.0,"81":265394.0,"82":270474.0,"83":275316.0,"84":280722.0,"85":286129.0,"86":291289.0,"87":296627.0,"88":302316.0,"89":308491.0,"90":314474.0,"91":320236.0,"92":325840.0,"93":331311.0,"94":336893.0,"95":342142.0,"96":344299.0},"Cluster 0":{"0":182.0,"1":473.0,"2":747.0,"3":1113.0,"4":1502.0,"5":1933.0,"6":2369.0,"7":2911.0,"8":3488.0,"9":4116.0,"10":4749.0,"11":5387.0,"12":6175.0,"13":6964.0,"14":7699.0,"15":8566.0,"16":9415.0,"17":10420.0,"18":11377.0,"19":12364.0,"20":13396.0,"21":14547.0,"22":15701.0,"23":16855.0,"24":18058.0,"25":19382.0,"26":20704.0,"27":22094.0,"28":23529.0,"29":25414.0,"30":27110.0,"31":28874.0,"32":30581.0,"33":32371.0,"34":34204.0,"35":36066.0,"36":37905.0,"37":39895.0,"38":41631.0,"39":43698.0,"40":45935.0,"41":48342.0,"42":50679.0,"43":52993.0,"44":55321.0,"45":57914.0,"46":60362.0,"47":62702.0,"48":65394.0,"49":68244.0,"50":70709.0,"51":73516.0,"52":76347.0,"53":79607.0,"54":82738.0,"55":85756.0,"56":88661.0,"57":91919.0,"58":94972.0,"59":98009.0,"60":101620.0,"61":105013.0,"62":108129.0,"63":111682.0,"64":115204.0,"65":119149.0,"66":122808.0,"67":126089.0,"68":129182.0,"69":132408.0,"70":135517.0,"71":138620.0,"72":142113.0,"73":145445.0,"74":148514.0,"75":151693.0,"76":155111.0,"77":158872.0,"78":162719.0,"79":166395.0,"80":170088.0,"81":173818.0,"82":177276.0,"83":180705.0,"84":184695.0,"85":188549.0,"86":192243.0,"87":196010.0,"88":200094.0,"89":204647.0,"90":209164.0,"91":213352.0,"92":217389.0,"93":221390.0,"94":225285.0,"95":229307.0,"96":231081.0},"Cluster 2":{"0":84.0,"1":225.0,"2":355.0,"3":520.0,"4":751.0,"5":966.0,"6":1222.0,"7":1517.0,"8":1842.0,"9":2256.0,"10":2676.0,"11":3072.0,"12":3497.0,"13":3940.0,"14":4366.0,"15":4878.0,"16":5371.0,"17":5959.0,"18":6521.0,"19":7101.0,"20":7723.0,"21":8393.0,"22":9081.0,"23":9731.0,"24":10419.0,"25":11195.0,"26":11941.0,"27":12798.0,"28":13700.0,"29":14793.0,"30":15880.0,"31":16953.0,"32":17982.0,"33":19034.0,"34":20217.0,"35":21264.0,"36":22302.0,"37":23503.0,"38":24554.0,"39":25820.0,"40":27191.0,"41":28636.0,"42":30012.0,"43":31481.0,"44":32901.0,"45":34347.0,"46":35886.0,"47":37252.0,"48":38827.0,"49":40386.0,"50":41798.0,"51":43502.0,"52":45137.0,"53":47065.0,"54":48926.0,"55":50773.0,"56":52535.0,"57":54485.0,"58":56421.0,"59":58204.0,"60":60155.0,"61":62032.0,"62":63824.0,"63":65819.0,"64":67837.0,"65":70139.0,"66":72355.0,"67":74260.0,"68":76071.0,"69":77999.0,"70":79811.0,"71":81629.0,"72":83456.0,"73":85210.0,"74":86820.0,"75":88633.0,"76":90419.0,"77":92421.0,"78":94438.0,"79":96392.0,"80":98403.0,"81":100449.0,"82":102358.0,"83":104290.0,"84":106284.0,"85":108281.0,"86":110235.0,"87":112337.0,"88":114458.0,"89":116806.0,"90":119062.0,"91":121278.0,"92":123491.0,"93":125521.0,"94":127612.0,"95":129625.0,"96":130488.0},"Cluster 4":{"0":131.0,"1":326.0,"2":514.0,"3":751.0,"4":1024.0,"5":1362.0,"6":1722.0,"7":2064.0,"8":2451.0,"9":2886.0,"10":3322.0,"11":3737.0,"12":4249.0,"13":4772.0,"14":5260.0,"15":5853.0,"16":6410.0,"17":7056.0,"18":7658.0,"19":8284.0,"20":8993.0,"21":9715.0,"22":10470.0,"23":11195.0,"24":11914.0,"25":12713.0,"26":13538.0,"27":14463.0,"28":15348.0,"29":16414.0,"30":17442.0,"31":18457.0,"32":19463.0,"33":20497.0,"34":21573.0,"35":22677.0,"36":23696.0,"37":24796.0,"38":25818.0,"39":26968.0,"40":28227.0,"41":29512.0,"42":30799.0,"43":32097.0,"44":33308.0,"45":34678.0,"46":36076.0,"47":37359.0,"48":38809.0,"49":40163.0,"50":41440.0,"51":42976.0,"52":44440.0,"53":46095.0,"54":47661.0,"55":49204.0,"56":50704.0,"57":52268.0,"58":53902.0,"59":55425.0,"60":57051.0,"61":58668.0,"62":60175.0,"63":61873.0,"64":63575.0,"65":65435.0,"66":67267.0,"67":68824.0,"68":70305.0,"69":71942.0,"70":73429.0,"71":74943.0,"72":76498.0,"73":78065.0,"74":79550.0,"75":81065.0,"76":82602.0,"77":84272.0,"78":85988.0,"79":87746.0,"80":89499.0,"81":91385.0,"82":93060.0,"83":94701.0,"84":96490.0,"85":98392.0,"86":100211.0,"87":102103.0,"88":104050.0,"89":106089.0,"90":108157.0,"91":110116.0,"92":112133.0,"93":114037.0,"94":115995.0,"95":117924.0,"96":118712.0}}';

	var vis_json = JSON.parse(vis_json_text);
	var vis_json_absolute = JSON.parse(vis_json_text_absolute);

	// Run function periodically to make things move.
	var timeout;
	var starting = 0;
	var nodesArrayIndex = 0;

	var total_count = 0;

	var total_count_yoy = 0;

	var month_year = vis_json["Month-Year"];
	var clusters = {
		0: vis_json["Cluster 0"],
		1: vis_json["Cluster 1"],
		2: vis_json["Cluster 2"],
		3: vis_json["Cluster 3"],
		4: vis_json["Cluster 4"],
	};
	var clusters_absolute = {
		0: vis_json_absolute["Cluster 0"],
		1: vis_json_absolute["Cluster 1"],
		2: vis_json_absolute["Cluster 2"],
		3: vis_json_absolute["Cluster 3"],
		4: vis_json_absolute["Cluster 4"],
	};

	var month = {
		"01": "Jan",
		"02": "Feb",
		"03": "Mar",
		"04": "Apr",
		"05": "May",
		"06": "Jun",
		"07": "Jul",
		"08": "Aug",
		"09": "Sep",
		"10": "Oct",
		"11": "Nov",
		"12": "Dec",
	};

	function timer() {

		var total_count_before = total_count;

		var index;
		for(index = 0; index < d3.keys(clusters).length; index++) {

			var curr_cluster = clusters[index];
			var curr_cluster_absolute = clusters_absolute[index];
			var nested_index;
			var choice = d3.keys(foci)[index];

			if(starting == 0) {

				for(nested_index = 0; nested_index < curr_cluster[starting]; nested_index++) {
					nodes[nodesArrayIndex].cx = foci[choice].x;
				    nodes[nodesArrayIndex].cy = foci[choice].y;
				    nodes[nodesArrayIndex].choice = choice;
				    nodesArrayIndex = nodesArrayIndex + 1;   
				}

				var counts = curr_cluster_absolute[starting];
				cluster_counts[String(index)] += counts;

			}

			else {

				var difference = curr_cluster[starting] - curr_cluster[starting-1];
				for(nested_index = 0; nested_index < difference; nested_index++) {
					nodes[nodesArrayIndex].cx = foci[choice].x;
				    nodes[nodesArrayIndex].cy = foci[choice].y;
				    nodes[nodesArrayIndex].choice = choice;
				    nodesArrayIndex = nodesArrayIndex + 1;   
				}

				var counts = curr_cluster_absolute[starting] - curr_cluster_absolute[starting-1];
				var yoy = counts/curr_cluster_absolute[starting-1];

				cluster_counts[String(index)] += counts;
				cluster_yoy[String(index)] = yoy;

			}

			total_count += counts;

		}

		if(total_count_before != 0) total_count_yoy = (total_count - total_count_before)/total_count_before;

		d3.select("#current_time").text(month[month_year[starting].split("-")[1]] + " " + month_year[starting].split("-")[0]);

		starting++;

		label.selectAll("tspan.num")
			.text(function(d) {
				return "[" + cluster_counts[d.index] + ", " + 
				readablePercent(cluster_counts[d.index]/total_count) + ", " +
				readableChange(cluster_yoy[d.index]) + "]";
			});

		d3.select("#total_num_bottom")
			.text(function(d) {
				return String(total_count) + ", " + readableChange(total_count_yoy);
			});
	    
	    force.resume();
	    
	    // Run it again in a few seconds.
	    if(starting <= 96) timeout = setTimeout(timer, speeds[USER_SPEED]);
	}

	timeout = setTimeout(timer, speeds[USER_SPEED]);

	//
	// Force-directed boiler plate functions
	//

	function tick(e) {
		circle
		.each(gravity(.051 * e.alpha))
	  	.each(collide(.5))
	  	.style("fill", function(d) { return foci[d.choice].color; })
	    .attr("cx", function(d) { return d.x; })
	    .attr("cy", function(d) { return d.y; });
	}


	// Move nodes toward cluster focus.
	function gravity(alpha) {
		return function(d) {
			d.y += (foci[d.choice].y - d.y) * alpha;
			d.x += (foci[d.choice].x - d.x) * alpha;
		};
	}

	// Resolve collisions between nodes.
	function collide(alpha) {
		var quadtree = d3.geom.quadtree(nodes);
		return function(d) {
			var r = d.radius + node_radius + Math.max(padding, cluster_padding),
	        nx1 = d.x - r,
	        nx2 = d.x + r,
	        ny1 = d.y - r,
	        ny2 = d.y + r;
	        quadtree.visit(function(quad, x1, y1, x2, y2) {
	         	if (quad.point && (quad.point !== d)) {
	         		var x = d.x - quad.point.x,
	         		y = d.y - quad.point.y,
	         		l = Math.sqrt(x * x + y * y),
	         		r = d.radius + quad.point.radius + (d.choice === quad.point.choice ? padding : cluster_padding);
	         		if (l < r) {
	         			l = (l - r) / l * alpha;
	         			d.x -= x *= l;
	         			d.y -= y *= l;
	         			quad.point.x += x;
	         			quad.point.y += y;
	         		}
	         	}
	         return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
	        })
	    };
	}

	d3.selectAll(".togglebutton")
      .on("click", function() {
        if (d3.select(this).attr("data-val") == "slow") {
            d3.select(".slow").classed("current", true);
			d3.select(".medium").classed("current", false);
            d3.select(".fast").classed("current", false);
        } else if (d3.select(this).attr("data-val") == "medium") {
            d3.select(".slow").classed("current", false);
			d3.select(".medium").classed("current", true);
            d3.select(".fast").classed("current", false);
        } 
		else {
            d3.select(".slow").classed("current", false);
			d3.select(".medium").classed("current", false);
			d3.select(".fast").classed("current", true);
        }
		
		USER_SPEED = d3.select(this).attr("data-val");
    });

    // Output readable percent based on count.
	function readablePercent(n) {
	
		var pct;
		if (n < 0.01) {
			pct = "<1%";
		} else {
			pct = (n * 100).toFixed(1) + "%";
		}
	
		return pct;
	}

	function readableChange(n) {

		var change;
		if (n < 0) {
			change = "-" + readablePercent(n);
		}
		else if (n == 0) {
			change = "0.0%";
		}
		else {
			if(readablePercent(n) != "<1%") change = "+" + readablePercent(n);
			else change = readablePercent(n);
		}
		return change;

	}

	</script>

</body>