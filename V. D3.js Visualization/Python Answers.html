<!DOCTYPE html>

<head>
	<title>Clustering Simulation - Python Answers</title>
	<link rel="stylesheet" href="style.css" type="text/css" media="screen"/>
</head>

<meta charset="utf-8">
<style>.node{stroke-width:1.5px;}</style>

<body style="background-color:black;">

	<div id="main-wrapper">

	<div id="note"></div>

	</div>
	<div id="chart1"></div>
	<div class="clr"></div>
	</div>

	<div id="speed">
	<div class="togglebutton slow" data-val="slow">Slow</div>
	<div class="togglebutton medium current" data-val="medium">Medium</div>
	<div class="togglebutton fast" data-val="fast">Fast</div>
	<div class="clr"></div>
	</div>

	<div id="current_time">Month-Year</div>

	<div id="total_num_top">Total Answers:</div>
	<div id="total_num_bottom">0, 0%</div>

	<div id="chart2"></div>
	<div class="clr"></div>

	<script src="d3.js/d3-3-5-5.min.js"></script>

	<script>

	var USER_SPEED = "medium";

	var speeds = { "slow": 1000, "medium": 200, "fast": 50 };

	var width = 700,
    	height = 700;

	var node_radius = 3.5,
	    padding = 1,
	    cluster_padding = 10,
	    num_nodes = 700;   

	var svg = d3.select("#chart1").append("svg")
    	.attr("width", width)
    	.attr("height", height)
    	.append("g")

	// Foci
	var foci = {
		"center": { x: 350, y: 340, color: "#AFAFB0" },
		0: { x: 350, y: 100, color: "#D70035" }, 
		1: { x: 590, y: 340, color: "#00A968" }, 
		2: { x: 470, y: 547.847, color: "#CC7EB1" },
		3: { x: 230, y: 547.847, color: "#AACF53" },
		4: { x: 110, y: 340, color: "#1E50A2" },
	};

	var cluster_codes = [
		{"index": "0", "name": "Utility", "tag": "(Directory, Path, Folder)"},
		{"index": "1", "name": "Data Structures Related", "tag": "(Dictionary, Node, Parent)"},
		{"index": "2", "name": "Web Retrieval", "tag": "(Request, Store, Unicode)"},
		{"index": "3", "name": "Web Framework/Database", "tag": "(Django, Database, Query)"},
		{"index": "4", "name": "General Programming", "tag": "(Generator, Compile, Algorithm)"},
	];

	var cluster_counts = { "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 0};
	var cluster_yoy = { "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 0};

	// Create node objects
	var nodes = d3.range(0, num_nodes).map(function(o, i) {
		return {
			id: "node" + i,
			x: foci.center.x + Math.random(),
			y: foci.center.y + Math.random(),
			radius: node_radius,
			choice: "center",
		}
	});

	// Force-directed layout
	var force = d3.layout.force()
		.nodes(nodes)
		.size([width, height])
		.gravity(0)
		.charge(0)
		.friction(.91)
		.on("tick", tick)
		.start();
	    
	// Draw circle for each node.
	var circle = svg.selectAll("circle")
		.data(nodes)
	    .enter().append("circle")
		.attr("id", function(d) { return d.id; })
		.attr("class", "node")
		.style("fill", function(d) { return foci[d.choice].color; });

	// Labels

	var label = svg.selectAll("text")
		.data(cluster_codes)
	    .enter().append("text")
		.attr("class", "cluster_label")
		.attr("x", function(d, i) {
			var cluster_index = Number(d.index);
			return foci[cluster_index].x;
		})
		.attr("y", function(d, i) {
			var cluster_index = Number(d.index);
			return foci[cluster_index].y;		
		});
		
	label.append("tspan")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("fill", "#FFFFFF")
		.attr("font-size", "21px")
		.text(function(d) {
			return d.name;
		});

	label.append("tspan")
		.attr("dy", "1.1em")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("fill", "#FFFFFF")
		.attr("font-size", "12px")
		.text(function(d) {
			return d.tag;
		});

	label.append("tspan")
		.attr("dy", "1.2em")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("font-size", "13px")
		.attr("class", "num")
		.attr("fill", "#FFFFFF")
		.text(function(d) {
			return "[" + cluster_counts[d.index] + ", " + "<1%" + ", " + 
			readableChange(cluster_yoy[d.index]) + "]";
		});

	// For smoother initial transition to settling spots.
	circle.transition()
		.duration(900)
		.delay(function(d,i) { return i * 5; })
		.attrTween("r", function(d) {
			var i = d3.interpolate(0, d.radius);
			return function(t) { return d.radius = i(t); };
		});

	var exact_num = 979544;

	var vis_json_text = '{"Month-Year":{"0":"2008-10-01","1":"2008-11-01","2":"2008-12-01","3":"2009-01-01","4":"2009-02-01","5":"2009-03-01","6":"2009-04-01","7":"2009-05-01","8":"2009-06-01","9":"2009-07-01","10":"2009-08-01","11":"2009-09-01","12":"2009-10-01","13":"2009-11-01","14":"2009-12-01","15":"2010-01-01","16":"2010-02-01","17":"2010-03-01","18":"2010-04-01","19":"2010-05-01","20":"2010-06-01","21":"2010-07-01","22":"2010-08-01","23":"2010-09-01","24":"2010-10-01","25":"2010-11-01","26":"2010-12-01","27":"2011-01-01","28":"2011-02-01","29":"2011-03-01","30":"2011-04-01","31":"2011-05-01","32":"2011-06-01","33":"2011-07-01","34":"2011-08-01","35":"2011-09-01","36":"2011-10-01","37":"2011-11-01","38":"2011-12-01","39":"2012-01-01","40":"2012-02-01","41":"2012-03-01","42":"2012-04-01","43":"2012-05-01","44":"2012-06-01","45":"2012-07-01","46":"2012-08-01","47":"2012-09-01","48":"2012-10-01","49":"2012-11-01","50":"2012-12-01","51":"2013-01-01","52":"2013-02-01","53":"2013-03-01","54":"2013-04-01","55":"2013-05-01","56":"2013-06-01","57":"2013-07-01","58":"2013-08-01","59":"2013-09-01","60":"2013-10-01","61":"2013-11-01","62":"2013-12-01","63":"2014-01-01","64":"2014-02-01","65":"2014-03-01","66":"2014-04-01","67":"2014-05-01","68":"2014-06-01","69":"2014-07-01","70":"2014-08-01","71":"2014-09-01","72":"2014-10-01","73":"2014-11-01","74":"2014-12-01","75":"2015-01-01","76":"2015-02-01","77":"2015-03-01","78":"2015-04-01","79":"2015-05-01","80":"2015-06-01","81":"2015-07-01","82":"2015-08-01","83":"2015-09-01","84":"2015-10-01","85":"2015-11-01","86":"2015-12-01","87":"2016-01-01","88":"2016-02-01","89":"2016-03-01","90":"2016-04-01","91":"2016-05-01","92":"2016-06-01","93":"2016-07-01","94":"2016-08-01","95":"2016-09-01","96":"2016-10-01"},"Cluster 4":{"0":0.0,"1":0.0,"2":0.0,"3":1.0,"4":1.0,"5":2.0,"6":3.0,"7":3.0,"8":4.0,"9":5.0,"10":5.0,"11":6.0,"12":7.0,"13":8.0,"14":9.0,"15":10.0,"16":11.0,"17":13.0,"18":14.0,"19":15.0,"20":16.0,"21":17.0,"22":19.0,"23":20.0,"24":21.0,"25":23.0,"26":24.0,"27":26.0,"28":27.0,"29":29.0,"30":31.0,"31":33.0,"32":34.0,"33":36.0,"34":38.0,"35":40.0,"36":41.0,"37":43.0,"38":45.0,"39":47.0,"40":49.0,"41":51.0,"42":53.0,"43":56.0,"44":58.0,"45":61.0,"46":63.0,"47":65.0,"48":68.0,"49":71.0,"50":73.0,"51":76.0,"52":78.0,"53":81.0,"54":85.0,"55":88.0,"56":91.0,"57":94.0,"58":98.0,"59":101.0,"60":105.0,"61":108.0,"62":112.0,"63":115.0,"64":119.0,"65":123.0,"66":127.0,"67":130.0,"68":133.0,"69":137.0,"70":140.0,"71":143.0,"72":147.0,"73":150.0,"74":154.0,"75":157.0,"76":161.0,"77":165.0,"78":169.0,"79":174.0,"80":178.0,"81":182.0,"82":186.0,"83":190.0,"84":194.0,"85":199.0,"86":203.0,"87":207.0,"88":212.0,"89":217.0,"90":222.0,"91":226.0,"92":231.0,"93":235.0,"94":240.0,"95":244.0,"96":246.0},"Cluster 0":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":1.0,"5":1.0,"6":1.0,"7":2.0,"8":2.0,"9":3.0,"10":3.0,"11":4.0,"12":4.0,"13":5.0,"14":6.0,"15":6.0,"16":7.0,"17":8.0,"18":8.0,"19":9.0,"20":10.0,"21":11.0,"22":11.0,"23":12.0,"24":13.0,"25":14.0,"26":15.0,"27":16.0,"28":17.0,"29":18.0,"30":19.0,"31":20.0,"32":21.0,"33":22.0,"34":24.0,"35":25.0,"36":26.0,"37":27.0,"38":28.0,"39":29.0,"40":31.0,"41":32.0,"42":34.0,"43":35.0,"44":37.0,"45":38.0,"46":40.0,"47":41.0,"48":43.0,"49":45.0,"50":46.0,"51":48.0,"52":50.0,"53":52.0,"54":54.0,"55":56.0,"56":58.0,"57":60.0,"58":62.0,"59":64.0,"60":66.0,"61":68.0,"62":71.0,"63":73.0,"64":75.0,"65":78.0,"66":80.0,"67":82.0,"68":84.0,"69":87.0,"70":89.0,"71":91.0,"72":93.0,"73":95.0,"74":97.0,"75":100.0,"76":102.0,"77":105.0,"78":107.0,"79":110.0,"80":113.0,"81":116.0,"82":118.0,"83":121.0,"84":124.0,"85":126.0,"86":129.0,"87":132.0,"88":135.0,"89":138.0,"90":141.0,"91":144.0,"92":147.0,"93":149.0,"94":152.0,"95":155.0,"96":156.0},"Cluster 1":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":0.0,"6":1.0,"7":1.0,"8":1.0,"9":2.0,"10":2.0,"11":2.0,"12":3.0,"13":3.0,"14":3.0,"15":4.0,"16":4.0,"17":5.0,"18":5.0,"19":6.0,"20":6.0,"21":7.0,"22":7.0,"23":8.0,"24":8.0,"25":9.0,"26":10.0,"27":10.0,"28":11.0,"29":12.0,"30":12.0,"31":13.0,"32":14.0,"33":15.0,"34":16.0,"35":16.0,"36":17.0,"37":18.0,"38":19.0,"39":20.0,"40":21.0,"41":22.0,"42":23.0,"43":24.0,"44":25.0,"45":26.0,"46":27.0,"47":28.0,"48":29.0,"49":30.0,"50":31.0,"51":33.0,"52":34.0,"53":35.0,"54":37.0,"55":38.0,"56":39.0,"57":41.0,"58":43.0,"59":44.0,"60":46.0,"61":48.0,"62":49.0,"63":51.0,"64":52.0,"65":54.0,"66":56.0,"67":58.0,"68":59.0,"69":61.0,"70":62.0,"71":64.0,"72":65.0,"73":67.0,"74":68.0,"75":70.0,"76":72.0,"77":74.0,"78":76.0,"79":78.0,"80":80.0,"81":82.0,"82":84.0,"83":86.0,"84":88.0,"85":90.0,"86":92.0,"87":94.0,"88":96.0,"89":99.0,"90":101.0,"91":103.0,"92":105.0,"93":107.0,"94":109.0,"95":111.0,"96":112.0},"Cluster 3":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":1.0,"6":1.0,"7":1.0,"8":2.0,"9":2.0,"10":2.0,"11":3.0,"12":3.0,"13":4.0,"14":4.0,"15":5.0,"16":5.0,"17":6.0,"18":6.0,"19":7.0,"20":7.0,"21":8.0,"22":8.0,"23":9.0,"24":9.0,"25":10.0,"26":11.0,"27":11.0,"28":12.0,"29":13.0,"30":14.0,"31":14.0,"32":15.0,"33":16.0,"34":17.0,"35":17.0,"36":18.0,"37":19.0,"38":19.0,"39":20.0,"40":21.0,"41":22.0,"42":23.0,"43":24.0,"44":25.0,"45":26.0,"46":27.0,"47":28.0,"48":29.0,"49":29.0,"50":30.0,"51":31.0,"52":32.0,"53":33.0,"54":34.0,"55":36.0,"56":37.0,"57":38.0,"58":39.0,"59":40.0,"60":41.0,"61":43.0,"62":44.0,"63":45.0,"64":46.0,"65":48.0,"66":49.0,"67":51.0,"68":52.0,"69":53.0,"70":54.0,"71":55.0,"72":57.0,"73":58.0,"74":59.0,"75":60.0,"76":62.0,"77":63.0,"78":65.0,"79":66.0,"80":68.0,"81":69.0,"82":71.0,"83":72.0,"84":74.0,"85":75.0,"86":77.0,"87":79.0,"88":80.0,"89":82.0,"90":84.0,"91":85.0,"92":87.0,"93":88.0,"94":90.0,"95":92.0,"96":92.0},"Cluster 2":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":1.0,"6":1.0,"7":1.0,"8":2.0,"9":2.0,"10":2.0,"11":3.0,"12":3.0,"13":4.0,"14":4.0,"15":5.0,"16":5.0,"17":6.0,"18":6.0,"19":7.0,"20":7.0,"21":8.0,"22":9.0,"23":9.0,"24":10.0,"25":10.0,"26":11.0,"27":12.0,"28":12.0,"29":13.0,"30":14.0,"31":14.0,"32":15.0,"33":16.0,"34":17.0,"35":17.0,"36":18.0,"37":19.0,"38":19.0,"39":20.0,"40":21.0,"41":22.0,"42":23.0,"43":24.0,"44":25.0,"45":26.0,"46":27.0,"47":28.0,"48":29.0,"49":30.0,"50":31.0,"51":32.0,"52":33.0,"53":34.0,"54":35.0,"55":36.0,"56":37.0,"57":38.0,"58":40.0,"59":41.0,"60":42.0,"61":43.0,"62":44.0,"63":46.0,"64":47.0,"65":48.0,"66":50.0,"67":51.0,"68":52.0,"69":53.0,"70":55.0,"71":56.0,"72":57.0,"73":58.0,"74":59.0,"75":61.0,"76":62.0,"77":63.0,"78":65.0,"79":66.0,"80":68.0,"81":69.0,"82":71.0,"83":72.0,"84":74.0,"85":75.0,"86":76.0,"87":78.0,"88":80.0,"89":81.0,"90":83.0,"91":84.0,"92":86.0,"93":87.0,"94":89.0,"95":90.0,"96":91.0}}';

	var vis_json_text_absolute = '{"Month-Year":{"0":"2008-10-01","1":"2008-11-01","2":"2008-12-01","3":"2009-01-01","4":"2009-02-01","5":"2009-03-01","6":"2009-04-01","7":"2009-05-01","8":"2009-06-01","9":"2009-07-01","10":"2009-08-01","11":"2009-09-01","12":"2009-10-01","13":"2009-11-01","14":"2009-12-01","15":"2010-01-01","16":"2010-02-01","17":"2010-03-01","18":"2010-04-01","19":"2010-05-01","20":"2010-06-01","21":"2010-07-01","22":"2010-08-01","23":"2010-09-01","24":"2010-10-01","25":"2010-11-01","26":"2010-12-01","27":"2011-01-01","28":"2011-02-01","29":"2011-03-01","30":"2011-04-01","31":"2011-05-01","32":"2011-06-01","33":"2011-07-01","34":"2011-08-01","35":"2011-09-01","36":"2011-10-01","37":"2011-11-01","38":"2011-12-01","39":"2012-01-01","40":"2012-02-01","41":"2012-03-01","42":"2012-04-01","43":"2012-05-01","44":"2012-06-01","45":"2012-07-01","46":"2012-08-01","47":"2012-09-01","48":"2012-10-01","49":"2012-11-01","50":"2012-12-01","51":"2013-01-01","52":"2013-02-01","53":"2013-03-01","54":"2013-04-01","55":"2013-05-01","56":"2013-06-01","57":"2013-07-01","58":"2013-08-01","59":"2013-09-01","60":"2013-10-01","61":"2013-11-01","62":"2013-12-01","63":"2014-01-01","64":"2014-02-01","65":"2014-03-01","66":"2014-04-01","67":"2014-05-01","68":"2014-06-01","69":"2014-07-01","70":"2014-08-01","71":"2014-09-01","72":"2014-10-01","73":"2014-11-01","74":"2014-12-01","75":"2015-01-01","76":"2015-02-01","77":"2015-03-01","78":"2015-04-01","79":"2015-05-01","80":"2015-06-01","81":"2015-07-01","82":"2015-08-01","83":"2015-09-01","84":"2015-10-01","85":"2015-11-01","86":"2015-12-01","87":"2016-01-01","88":"2016-02-01","89":"2016-03-01","90":"2016-04-01","91":"2016-05-01","92":"2016-06-01","93":"2016-07-01","94":"2016-08-01","95":"2016-09-01","96":"2016-10-01"},"Cluster 4":{"0":308.0,"1":797.0,"2":1264.0,"3":1972.0,"4":2626.0,"5":3421.0,"6":4203.0,"7":5177.0,"8":6260.0,"9":7318.0,"10":8391.0,"11":9414.0,"12":10706.0,"13":12204.0,"14":13633.0,"15":15290.0,"16":16753.0,"17":18584.0,"18":19981.0,"19":21480.0,"20":23030.0,"21":25030.0,"22":26953.0,"23":28487.0,"24":30569.0,"25":32575.0,"26":34443.0,"27":36573.0,"28":38707.0,"29":41461.0,"30":43839.0,"31":46228.0,"32":48618.0,"33":51085.0,"34":53723.0,"35":55989.0,"36":58350.0,"37":60854.0,"38":63214.0,"39":66085.0,"40":69025.0,"41":72339.0,"42":75433.0,"43":78662.0,"44":82012.0,"45":85488.0,"46":88991.0,"47":92083.0,"48":95829.0,"49":99594.0,"50":102941.0,"51":106645.0,"52":110389.0,"53":114604.0,"54":119204.0,"55":123668.0,"56":127913.0,"57":132775.0,"58":137254.0,"59":141702.0,"60":146970.0,"61":152325.0,"62":156903.0,"63":162093.0,"64":167352.0,"65":173322.0,"66":178910.0,"67":183253.0,"68":187429.0,"69":192374.0,"70":196792.0,"71":201100.0,"72":205855.0,"73":211000.0,"74":215735.0,"75":220677.0,"76":225707.0,"77":231520.0,"78":237613.0,"79":243560.0,"80":249366.0,"81":255457.0,"82":260836.0,"83":266360.0,"84":272845.0,"85":278966.0,"86":284593.0,"87":290636.0,"88":297372.0,"89":304364.0,"90":311181.0,"91":317475.0,"92":323710.0,"93":329976.0,"94":336534.0,"95":342720.0,"96":345259.0},"Cluster 0":{"0":207.0,"1":523.0,"2":849.0,"3":1274.0,"4":1686.0,"5":2189.0,"6":2626.0,"7":3260.0,"8":3873.0,"9":4536.0,"10":5173.0,"11":5867.0,"12":6675.0,"13":7614.0,"14":8568.0,"15":9659.0,"16":10578.0,"17":11596.0,"18":12515.0,"19":13369.0,"20":14341.0,"21":15568.0,"22":16791.0,"23":17810.0,"24":19073.0,"25":20324.0,"26":21509.0,"27":22899.0,"28":24275.0,"29":26048.0,"30":27504.0,"31":28990.0,"32":30487.0,"33":32039.0,"34":33730.0,"35":35244.0,"36":36779.0,"37":38363.0,"38":39904.0,"39":41776.0,"40":43702.0,"41":45796.0,"42":47732.0,"43":49812.0,"44":51952.0,"45":54251.0,"46":56578.0,"47":58563.0,"48":60866.0,"49":63215.0,"50":65368.0,"51":67803.0,"52":70235.0,"53":73025.0,"54":75764.0,"55":78511.0,"56":81169.0,"57":84330.0,"58":87071.0,"59":89829.0,"60":93224.0,"61":96421.0,"62":99372.0,"63":102742.0,"64":106078.0,"65":109926.0,"66":113341.0,"67":116078.0,"68":118797.0,"69":122046.0,"70":124904.0,"71":127737.0,"72":130760.0,"73":133962.0,"74":136795.0,"75":140008.0,"76":143394.0,"77":147110.0,"78":150945.0,"79":154781.0,"80":158487.0,"81":162532.0,"82":166207.0,"83":169682.0,"84":173605.0,"85":177341.0,"86":180963.0,"87":184973.0,"88":189247.0,"89":193774.0,"90":198137.0,"91":202139.0,"92":205979.0,"93":209844.0,"94":213885.0,"95":217766.0,"96":219291.0},"Cluster 1":{"0":128.0,"1":328.0,"2":513.0,"3":777.0,"4":1035.0,"5":1355.0,"6":1650.0,"7":2045.0,"8":2427.0,"9":2872.0,"10":3309.0,"11":3784.0,"12":4327.0,"13":4910.0,"14":5504.0,"15":6224.0,"16":6825.0,"17":7472.0,"18":8067.0,"19":8677.0,"20":9359.0,"21":10149.0,"22":10952.0,"23":11677.0,"24":12483.0,"25":13265.0,"26":14098.0,"27":14995.0,"28":15900.0,"29":17041.0,"30":18047.0,"31":19168.0,"32":20196.0,"33":21251.0,"34":22456.0,"35":23484.0,"36":24558.0,"37":25671.0,"38":26723.0,"39":28045.0,"40":29444.0,"41":30989.0,"42":32448.0,"43":33862.0,"44":35318.0,"45":36898.0,"46":38501.0,"47":39903.0,"48":41516.0,"49":43200.0,"50":44703.0,"51":46376.0,"52":48054.0,"53":49965.0,"54":52053.0,"55":53977.0,"56":55877.0,"57":58138.0,"58":60270.0,"59":62270.0,"60":64692.0,"61":67203.0,"62":69237.0,"63":71626.0,"64":74007.0,"65":76807.0,"66":79398.0,"67":81407.0,"68":83323.0,"69":85662.0,"70":87853.0,"71":89889.0,"72":92077.0,"73":94404.0,"74":96518.0,"75":98790.0,"76":101278.0,"77":104066.0,"78":106886.0,"79":109639.0,"80":112422.0,"81":115442.0,"82":118143.0,"83":120691.0,"84":123675.0,"85":126405.0,"86":129081.0,"87":131954.0,"88":135302.0,"89":138643.0,"90":141818.0,"91":144715.0,"92":147600.0,"93":150539.0,"94":153498.0,"95":156328.0,"96":157551.0},"Cluster 3":{"0":150.0,"1":360.0,"2":578.0,"3":888.0,"4":1215.0,"5":1631.0,"6":1982.0,"7":2459.0,"8":2988.0,"9":3559.0,"10":4020.0,"11":4548.0,"12":5148.0,"13":5769.0,"14":6453.0,"15":7251.0,"16":7979.0,"17":8674.0,"18":9358.0,"19":10072.0,"20":10816.0,"21":11574.0,"22":12323.0,"23":13022.0,"24":13822.0,"25":14734.0,"26":15515.0,"27":16508.0,"28":17483.0,"29":18639.0,"30":19698.0,"31":20777.0,"32":21846.0,"33":22867.0,"34":23924.0,"35":24881.0,"36":25808.0,"37":26861.0,"38":27852.0,"39":28972.0,"40":30080.0,"41":31392.0,"42":32589.0,"43":33860.0,"44":35207.0,"45":36669.0,"46":38104.0,"47":39323.0,"48":40604.0,"49":41871.0,"50":43124.0,"51":44557.0,"52":45969.0,"53":47476.0,"54":48956.0,"55":50502.0,"56":52006.0,"57":53570.0,"58":55177.0,"59":56716.0,"60":58479.0,"61":60321.0,"62":61993.0,"63":63928.0,"64":65706.0,"65":67709.0,"66":69632.0,"67":71374.0,"68":72965.0,"69":74790.0,"70":76442.0,"71":78097.0,"72":79799.0,"73":81513.0,"74":83282.0,"75":85160.0,"76":86925.0,"77":88952.0,"78":90975.0,"79":93187.0,"80":95429.0,"81":97710.0,"82":99870.0,"83":101991.0,"84":104156.0,"85":106253.0,"86":108362.0,"87":110676.0,"88":113080.0,"89":115525.0,"90":117776.0,"91":120147.0,"92":122306.0,"93":124461.0,"94":126782.0,"95":128966.0,"96":129748.0},"Cluster 2":{"0":138.0,"1":396.0,"2":672.0,"3":963.0,"4":1286.0,"5":1652.0,"6":1999.0,"7":2524.0,"8":3017.0,"9":3539.0,"10":4072.0,"11":4597.0,"12":5193.0,"13":5887.0,"14":6594.0,"15":7439.0,"16":8144.0,"17":8960.0,"18":9601.0,"19":10262.0,"20":11022.0,"21":11876.0,"22":12698.0,"23":13421.0,"24":14241.0,"25":15144.0,"26":16020.0,"27":16852.0,"28":17737.0,"29":18852.0,"30":19814.0,"31":20799.0,"32":21774.0,"33":22822.0,"34":23917.0,"35":24911.0,"36":25821.0,"37":26845.0,"38":27809.0,"39":28947.0,"40":30140.0,"41":31492.0,"42":32756.0,"43":34026.0,"44":35388.0,"45":36826.0,"46":38289.0,"47":39570.0,"48":40938.0,"49":42311.0,"50":43618.0,"51":45038.0,"52":46526.0,"53":48009.0,"54":49597.0,"55":51140.0,"56":52667.0,"57":54403.0,"58":56044.0,"59":57547.0,"60":59335.0,"61":61154.0,"62":62857.0,"63":64765.0,"64":66501.0,"65":68500.0,"66":70329.0,"67":71995.0,"68":73586.0,"69":75496.0,"70":77296.0,"71":78827.0,"72":80464.0,"73":82123.0,"74":83762.0,"75":85582.0,"76":87402.0,"77":89394.0,"78":91417.0,"79":93482.0,"80":95612.0,"81":97840.0,"82":99888.0,"83":101773.0,"84":103847.0,"85":105802.0,"86":107732.0,"87":109739.0,"88":111952.0,"89":114250.0,"90":116415.0,"91":118615.0,"92":120620.0,"93":122713.0,"94":124852.0,"95":126876.0,"96":127695.0}}';

	var vis_json = JSON.parse(vis_json_text);
	var vis_json_absolute = JSON.parse(vis_json_text_absolute);

	// Run function periodically to make things move.
	var timeout;
	var starting = 0;
	var nodesArrayIndex = 0;

	var total_count = 0;

	var total_count_yoy = 0;

	var month_year = vis_json["Month-Year"];
	var clusters = {
		0: vis_json["Cluster 0"],
		1: vis_json["Cluster 1"],
		2: vis_json["Cluster 2"],
		3: vis_json["Cluster 3"],
		4: vis_json["Cluster 4"],
	};
	var clusters_absolute = {
		0: vis_json_absolute["Cluster 0"],
		1: vis_json_absolute["Cluster 1"],
		2: vis_json_absolute["Cluster 2"],
		3: vis_json_absolute["Cluster 3"],
		4: vis_json_absolute["Cluster 4"],
	};

	var month = {
		"01": "Jan",
		"02": "Feb",
		"03": "Mar",
		"04": "Apr",
		"05": "May",
		"06": "Jun",
		"07": "Jul",
		"08": "Aug",
		"09": "Sep",
		"10": "Oct",
		"11": "Nov",
		"12": "Dec",
	};

	function timer() {

		var total_count_before = total_count;

		var index;
		for(index = 0; index < d3.keys(clusters).length; index++) {

			var curr_cluster = clusters[index];
			var curr_cluster_absolute = clusters_absolute[index];
			var nested_index;
			var choice = d3.keys(foci)[index];

			if(starting == 0) {

				for(nested_index = 0; nested_index < curr_cluster[starting]; nested_index++) {
					nodes[nodesArrayIndex].cx = foci[choice].x;
				    nodes[nodesArrayIndex].cy = foci[choice].y;
				    nodes[nodesArrayIndex].choice = choice;
				    nodesArrayIndex = nodesArrayIndex + 1;   
				}

				var counts = curr_cluster_absolute[starting];
				cluster_counts[String(index)] += counts;

			}

			else {

				var difference = curr_cluster[starting] - curr_cluster[starting-1];
				for(nested_index = 0; nested_index < difference; nested_index++) {
					nodes[nodesArrayIndex].cx = foci[choice].x;
				    nodes[nodesArrayIndex].cy = foci[choice].y;
				    nodes[nodesArrayIndex].choice = choice;
				    nodesArrayIndex = nodesArrayIndex + 1;   
				}

				var counts = curr_cluster_absolute[starting] - curr_cluster_absolute[starting-1];
				var yoy = counts/curr_cluster_absolute[starting-1];

				cluster_counts[String(index)] += counts;
				cluster_yoy[String(index)] = yoy;

			}

			total_count += counts;

		}

		if(total_count_before != 0) total_count_yoy = (total_count - total_count_before)/total_count_before;

		d3.select("#current_time").text(month[month_year[starting].split("-")[1]] + " " + month_year[starting].split("-")[0]);

		starting++;

		label.selectAll("tspan.num")
			.text(function(d) {
				return "[" + cluster_counts[d.index] + ", " + 
				readablePercent(cluster_counts[d.index]/total_count) + ", " +
				readableChange(cluster_yoy[d.index]) + "]";
			});

		d3.select("#total_num_bottom")
			.text(function(d) {
				return String(total_count) + ", " + readableChange(total_count_yoy);
			});
	    
	    force.resume();
	    
	    // Run it again in a few seconds.
	    if(starting <= 96) timeout = setTimeout(timer, speeds[USER_SPEED]);
	}

	timeout = setTimeout(timer, speeds[USER_SPEED]);

	//
	// Force-directed boiler plate functions
	//

	function tick(e) {
		circle
		.each(gravity(.051 * e.alpha))
	  	.each(collide(.5))
	  	.style("fill", function(d) { return foci[d.choice].color; })
	    .attr("cx", function(d) { return d.x; })
	    .attr("cy", function(d) { return d.y; });
	}


	// Move nodes toward cluster focus.
	function gravity(alpha) {
		return function(d) {
			d.y += (foci[d.choice].y - d.y) * alpha;
			d.x += (foci[d.choice].x - d.x) * alpha;
		};
	}

	// Resolve collisions between nodes.
	function collide(alpha) {
		var quadtree = d3.geom.quadtree(nodes);
		return function(d) {
			var r = d.radius + node_radius + Math.max(padding, cluster_padding),
	        nx1 = d.x - r,
	        nx2 = d.x + r,
	        ny1 = d.y - r,
	        ny2 = d.y + r;
	        quadtree.visit(function(quad, x1, y1, x2, y2) {
	         	if (quad.point && (quad.point !== d)) {
	         		var x = d.x - quad.point.x,
	         		y = d.y - quad.point.y,
	         		l = Math.sqrt(x * x + y * y),
	         		r = d.radius + quad.point.radius + (d.choice === quad.point.choice ? padding : cluster_padding);
	         		if (l < r) {
	         			l = (l - r) / l * alpha;
	         			d.x -= x *= l;
	         			d.y -= y *= l;
	         			quad.point.x += x;
	         			quad.point.y += y;
	         		}
	         	}
	         return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
	        })
	    };
	}

	d3.selectAll(".togglebutton")
      .on("click", function() {
        if (d3.select(this).attr("data-val") == "slow") {
            d3.select(".slow").classed("current", true);
			d3.select(".medium").classed("current", false);
            d3.select(".fast").classed("current", false);
        } else if (d3.select(this).attr("data-val") == "medium") {
            d3.select(".slow").classed("current", false);
			d3.select(".medium").classed("current", true);
            d3.select(".fast").classed("current", false);
        } 
		else {
            d3.select(".slow").classed("current", false);
			d3.select(".medium").classed("current", false);
			d3.select(".fast").classed("current", true);
        }
		
		USER_SPEED = d3.select(this).attr("data-val");
    });

    // Output readable percent based on count.
	function readablePercent(n) {
	
		var pct;
		if (n < 0.01) {
			pct = "<1%";
		} else {
			pct = (n * 100).toFixed(1) + "%";
		}
	
		return pct;
	}

	function readableChange(n) {

		var change;
		if (n < 0) {
			change = "-" + readablePercent(n);
		}
		else if (n == 0) {
			change = "0.0%";
		}
		else {
			if(readablePercent(n) != "<1%") change = "+" + readablePercent(n);
			else change = readablePercent(n);
		}
		return change;

	}

	</script>

</body>