<!DOCTYPE html>

<head>
	<title>Clustering Simulation - Stack Answers</title>
	<link rel="stylesheet" href="style.css" type="text/css" media="screen"/>
</head>

<meta charset="utf-8">
<style>.node{stroke-width:1.5px;}</style>

<body style="background-color:black;">

	<div id="main-wrapper">

	<div id="note"></div>

	</div>
	<div id="chart1"></div>
	<div class="clr"></div>
	</div>

	<div id="speed">
	<div class="togglebutton slow" data-val="slow">Slow</div>
	<div class="togglebutton medium current" data-val="medium">Medium</div>
	<div class="togglebutton fast" data-val="fast">Fast</div>
	<div class="clr"></div>
	</div>

	<div id="current_time">Month-Year</div>

	<div id="total_num_top">Total Answers:</div>
	<div id="total_num_bottom">0, 0%</div>

	<div id="chart2"></div>
	<div class="clr"></div>

	<script src="d3.js/d3-3-5-5.min.js"></script>

	<script>

	var USER_SPEED = "medium";

	var speeds = { "slow": 1000, "medium": 200, "fast": 50 };

	var width = 700,
    	height = 700;

	var node_radius = 3.5,
	    padding = 1,
	    cluster_padding = 10,
	    num_nodes = 700;   

	var svg = d3.select("#chart1").append("svg")
    	.attr("width", width)
    	.attr("height", height)
    	.append("g")

	// Foci
	var foci = {
		"center": { x: 350, y: 340, color: "#AFAFB0" },
		0: { x: 350, y: 100, color: "#D70035" }, 
		1: { x: 590, y: 340, color: "#00A968" }, 
		2: { x: 470, y: 547.847, color: "#CC7EB1" },
		3: { x: 230, y: 547.847, color: "#AACF53" },
		4: { x: 110, y: 340, color: "#1E50A2" },
	};

	var cluster_codes = [
		{"index": "0", "name": "Front-End Development", "tag": "(Image, Dimension, Pixel)"},
		{"index": "1", "name": "General Programming", "tag": "(Space, Pointer, Sort)"},
		{"index": "2", "name": "Software Engineering", "tag": "(Implemantation, Design, Pattern)"},
		{"index": "3", "name": "Back-End Development", "tag": "(App, Server, Database)"},
		{"index": "4", "name": "Database Manipulation", "tag": "(Table, Join, SQL)"},
	];

	var cluster_counts = { "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 0};
	var cluster_yoy = { "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 0};

	// Create node objects
	var nodes = d3.range(0, num_nodes).map(function(o, i) {
		return {
			id: "node" + i,
			x: foci.center.x + Math.random(),
			y: foci.center.y + Math.random(),
			radius: node_radius,
			choice: "center",
		}
	});

	// Force-directed layout
	var force = d3.layout.force()
		.nodes(nodes)
		.size([width, height])
		.gravity(0)
		.charge(0)
		.friction(.91)
		.on("tick", tick)
		.start();
	    
	// Draw circle for each node.
	var circle = svg.selectAll("circle")
		.data(nodes)
	    .enter().append("circle")
		.attr("id", function(d) { return d.id; })
		.attr("class", "node")
		.style("fill", function(d) { return foci[d.choice].color; });

	// Labels

	var label = svg.selectAll("text")
		.data(cluster_codes)
	    .enter().append("text")
		.attr("class", "cluster_label")
		.attr("x", function(d, i) {
			var cluster_index = Number(d.index);
			return foci[cluster_index].x;
		})
		.attr("y", function(d, i) {
			var cluster_index = Number(d.index);
			return foci[cluster_index].y;		
		});
		
	label.append("tspan")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("fill", "#FFFFFF")
		.attr("font-size", "21px")
		.text(function(d) {
			return d.name;
		});

	label.append("tspan")
		.attr("dy", "1.1em")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("fill", "#FFFFFF")
		.attr("font-size", "12px")
		.text(function(d) {
			return d.tag;
		});

	label.append("tspan")
		.attr("dy", "1.2em")
		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })
		.attr("text-anchor", "middle")
		.attr("font-family", "PT Sans")
		.attr("font-size", "13px")
		.attr("class", "num")
		.attr("fill", "#FFFFFF")
		.text(function(d) {
			return "[" + cluster_counts[d.index] + ", " + "<1%" + ", " + 
			readableChange(cluster_yoy[d.index]) + "]";
		});

	// For smoother initial transition to settling spots.
	circle.transition()
		.duration(900)
		.delay(function(d,i) { return i * 5; })
		.attrTween("r", function(d) {
			var i = d3.interpolate(0, d.radius);
			return function(t) { return d.radius = i(t); };
		});

	var exact_num = 1997427;

	var vis_json_text = '{"Month-Year":{"0":"2008-10-01","1":"2008-11-01","2":"2008-12-01","3":"2009-01-01","4":"2009-02-01","5":"2009-03-01","6":"2009-04-01","7":"2009-05-01","8":"2009-06-01","9":"2009-07-01","10":"2009-08-01","11":"2009-09-01","12":"2009-10-01","13":"2009-11-01","14":"2009-12-01","15":"2010-01-01","16":"2010-02-01","17":"2010-03-01","18":"2010-04-01","19":"2010-05-01","20":"2010-06-01","21":"2010-07-01","22":"2010-08-01","23":"2010-09-01","24":"2010-10-01","25":"2010-11-01","26":"2010-12-01","27":"2011-01-01","28":"2011-02-01","29":"2011-03-01","30":"2011-04-01","31":"2011-05-01","32":"2011-06-01","33":"2011-07-01","34":"2011-08-01","35":"2011-09-01","36":"2011-10-01","37":"2011-11-01","38":"2011-12-01","39":"2012-01-01","40":"2012-02-01","41":"2012-03-01","42":"2012-04-01","43":"2012-05-01","44":"2012-06-01","45":"2012-07-01","46":"2012-08-01","47":"2012-09-01","48":"2012-10-01","49":"2012-11-01","50":"2012-12-01","51":"2013-01-01","52":"2013-02-01","53":"2013-03-01","54":"2013-04-01","55":"2013-05-01","56":"2013-06-01","57":"2013-07-01","58":"2013-08-01","59":"2013-09-01","60":"2013-10-01","61":"2013-11-01","62":"2013-12-01","63":"2014-01-01","64":"2014-02-01","65":"2014-03-01","66":"2014-04-01","67":"2014-05-01","68":"2014-06-01","69":"2014-07-01","70":"2014-08-01","71":"2014-09-01","72":"2014-10-01","73":"2014-11-01","74":"2014-12-01","75":"2015-01-01","76":"2015-02-01","77":"2015-03-01","78":"2015-04-01","79":"2015-05-01","80":"2015-06-01","81":"2015-07-01","82":"2015-08-01","83":"2015-09-01","84":"2015-10-01","85":"2015-11-01","86":"2015-12-01","87":"2016-01-01","88":"2016-02-01","89":"2016-03-01","90":"2016-04-01","91":"2016-05-01","92":"2016-06-01","93":"2016-07-01","94":"2016-08-01","95":"2016-09-01","96":"2016-10-01"},"Cluster 3":{"0":0.0,"1":0.0,"2":1.0,"3":2.0,"4":2.0,"5":3.0,"6":4.0,"7":5.0,"8":6.0,"9":7.0,"10":8.0,"11":9.0,"12":10.0,"13":12.0,"14":13.0,"15":14.0,"16":16.0,"17":17.0,"18":19.0,"19":20.0,"20":22.0,"21":23.0,"22":25.0,"23":27.0,"24":28.0,"25":30.0,"26":32.0,"27":35.0,"28":37.0,"29":39.0,"30":42.0,"31":45.0,"32":47.0,"33":50.0,"34":53.0,"35":56.0,"36":58.0,"37":61.0,"38":64.0,"39":67.0,"40":70.0,"41":73.0,"42":76.0,"43":80.0,"44":83.0,"45":86.0,"46":90.0,"47":93.0,"48":97.0,"49":100.0,"50":103.0,"51":107.0,"52":110.0,"53":114.0,"54":118.0,"55":122.0,"56":126.0,"57":130.0,"58":134.0,"59":138.0,"60":142.0,"61":146.0,"62":149.0,"63":154.0,"64":158.0,"65":163.0,"66":167.0,"67":170.0,"68":174.0,"69":178.0,"70":181.0,"71":185.0,"72":188.0,"73":192.0,"74":195.0,"75":198.0,"76":202.0,"77":206.0,"78":210.0,"79":214.0,"80":218.0,"81":222.0,"82":226.0,"83":230.0,"84":233.0,"85":237.0,"86":241.0,"87":245.0,"88":248.0,"89":253.0,"90":257.0,"91":260.0,"92":264.0,"93":268.0,"94":272.0,"95":275.0,"96":277.0},"Cluster 1":{"0":0.0,"1":0.0,"2":0.0,"3":1.0,"4":1.0,"5":2.0,"6":2.0,"7":3.0,"8":3.0,"9":4.0,"10":5.0,"11":5.0,"12":6.0,"13":7.0,"14":8.0,"15":9.0,"16":10.0,"17":11.0,"18":12.0,"19":13.0,"20":14.0,"21":15.0,"22":16.0,"23":17.0,"24":18.0,"25":20.0,"26":21.0,"27":22.0,"28":24.0,"29":26.0,"30":27.0,"31":29.0,"32":31.0,"33":33.0,"34":35.0,"35":37.0,"36":39.0,"37":41.0,"38":43.0,"39":45.0,"40":47.0,"41":49.0,"42":51.0,"43":54.0,"44":56.0,"45":58.0,"46":61.0,"47":63.0,"48":65.0,"49":68.0,"50":70.0,"51":73.0,"52":75.0,"53":78.0,"54":81.0,"55":84.0,"56":86.0,"57":89.0,"58":92.0,"59":95.0,"60":98.0,"61":101.0,"62":103.0,"63":107.0,"64":110.0,"65":113.0,"66":116.0,"67":118.0,"68":121.0,"69":123.0,"70":126.0,"71":128.0,"72":131.0,"73":133.0,"74":136.0,"75":138.0,"76":140.0,"77":143.0,"78":145.0,"79":148.0,"80":151.0,"81":154.0,"82":156.0,"83":159.0,"84":161.0,"85":164.0,"86":166.0,"87":168.0,"88":171.0,"89":174.0,"90":177.0,"91":179.0,"92":182.0,"93":184.0,"94":186.0,"95":189.0,"96":190.0},"Cluster 2":{"0":0.0,"1":0.0,"2":1.0,"3":1.0,"4":2.0,"5":3.0,"6":3.0,"7":4.0,"8":5.0,"9":5.0,"10":6.0,"11":7.0,"12":8.0,"13":8.0,"14":9.0,"15":10.0,"16":11.0,"17":12.0,"18":13.0,"19":14.0,"20":15.0,"21":15.0,"22":16.0,"23":17.0,"24":18.0,"25":19.0,"26":20.0,"27":21.0,"28":22.0,"29":24.0,"30":25.0,"31":26.0,"32":27.0,"33":28.0,"34":29.0,"35":31.0,"36":32.0,"37":33.0,"38":34.0,"39":35.0,"40":36.0,"41":38.0,"42":39.0,"43":40.0,"44":42.0,"45":43.0,"46":44.0,"47":45.0,"48":47.0,"49":48.0,"50":49.0,"51":51.0,"52":52.0,"53":53.0,"54":55.0,"55":56.0,"56":57.0,"57":59.0,"58":60.0,"59":62.0,"60":63.0,"61":64.0,"62":66.0,"63":67.0,"64":69.0,"65":70.0,"66":71.0,"67":73.0,"68":74.0,"69":75.0,"70":76.0,"71":77.0,"72":79.0,"73":80.0,"74":81.0,"75":82.0,"76":83.0,"77":84.0,"78":86.0,"79":87.0,"80":88.0,"81":90.0,"82":91.0,"83":92.0,"84":93.0,"85":95.0,"86":96.0,"87":97.0,"88":98.0,"89":100.0,"90":101.0,"91":102.0,"92":103.0,"93":104.0,"94":106.0,"95":107.0,"96":107.0},"Cluster 0":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":0.0,"6":1.0,"7":1.0,"8":1.0,"9":1.0,"10":2.0,"11":2.0,"12":2.0,"13":2.0,"14":3.0,"15":3.0,"16":3.0,"17":4.0,"18":4.0,"19":4.0,"20":5.0,"21":5.0,"22":6.0,"23":6.0,"24":7.0,"25":7.0,"26":8.0,"27":8.0,"28":9.0,"29":9.0,"30":10.0,"31":11.0,"32":11.0,"33":12.0,"34":13.0,"35":13.0,"36":14.0,"37":15.0,"38":16.0,"39":16.0,"40":17.0,"41":18.0,"42":19.0,"43":20.0,"44":21.0,"45":22.0,"46":22.0,"47":23.0,"48":24.0,"49":25.0,"50":26.0,"51":27.0,"52":28.0,"53":29.0,"54":30.0,"55":31.0,"56":32.0,"57":33.0,"58":34.0,"59":35.0,"60":36.0,"61":37.0,"62":38.0,"63":40.0,"64":41.0,"65":42.0,"66":43.0,"67":44.0,"68":45.0,"69":46.0,"70":47.0,"71":48.0,"72":49.0,"73":50.0,"74":50.0,"75":51.0,"76":52.0,"77":53.0,"78":54.0,"79":56.0,"80":57.0,"81":58.0,"82":59.0,"83":60.0,"84":61.0,"85":62.0,"86":63.0,"87":64.0,"88":65.0,"89":66.0,"90":67.0,"91":68.0,"92":69.0,"93":70.0,"94":71.0,"95":72.0,"96":73.0},"Cluster 4":{"0":0.0,"1":0.0,"2":0.0,"3":0.0,"4":0.0,"5":0.0,"6":0.0,"7":1.0,"8":1.0,"9":1.0,"10":1.0,"11":1.0,"12":2.0,"13":2.0,"14":2.0,"15":2.0,"16":3.0,"17":3.0,"18":3.0,"19":4.0,"20":4.0,"21":4.0,"22":5.0,"23":5.0,"24":5.0,"25":6.0,"26":6.0,"27":6.0,"28":7.0,"29":7.0,"30":8.0,"31":8.0,"32":9.0,"33":9.0,"34":10.0,"35":10.0,"36":11.0,"37":11.0,"38":11.0,"39":12.0,"40":13.0,"41":13.0,"42":14.0,"43":14.0,"44":15.0,"45":16.0,"46":16.0,"47":17.0,"48":17.0,"49":18.0,"50":19.0,"51":19.0,"52":20.0,"53":21.0,"54":22.0,"55":22.0,"56":23.0,"57":24.0,"58":25.0,"59":25.0,"60":26.0,"61":27.0,"62":28.0,"63":28.0,"64":29.0,"65":30.0,"66":31.0,"67":31.0,"68":32.0,"69":33.0,"70":33.0,"71":34.0,"72":35.0,"73":35.0,"74":36.0,"75":37.0,"76":37.0,"77":38.0,"78":39.0,"79":40.0,"80":40.0,"81":41.0,"82":42.0,"83":43.0,"84":43.0,"85":44.0,"86":45.0,"87":45.0,"88":46.0,"89":47.0,"90":48.0,"91":48.0,"92":49.0,"93":50.0,"94":50.0,"95":51.0,"96":51.0}}';

	var vis_json_text_absolute = '{"Month-Year":{"0":"2008-10-01","1":"2008-11-01","2":"2008-12-01","3":"2009-01-01","4":"2009-02-01","5":"2009-03-01","6":"2009-04-01","7":"2009-05-01","8":"2009-06-01","9":"2009-07-01","10":"2009-08-01","11":"2009-09-01","12":"2009-10-01","13":"2009-11-01","14":"2009-12-01","15":"2010-01-01","16":"2010-02-01","17":"2010-03-01","18":"2010-04-01","19":"2010-05-01","20":"2010-06-01","21":"2010-07-01","22":"2010-08-01","23":"2010-09-01","24":"2010-10-01","25":"2010-11-01","26":"2010-12-01","27":"2011-01-01","28":"2011-02-01","29":"2011-03-01","30":"2011-04-01","31":"2011-05-01","32":"2011-06-01","33":"2011-07-01","34":"2011-08-01","35":"2011-09-01","36":"2011-10-01","37":"2011-11-01","38":"2011-12-01","39":"2012-01-01","40":"2012-02-01","41":"2012-03-01","42":"2012-04-01","43":"2012-05-01","44":"2012-06-01","45":"2012-07-01","46":"2012-08-01","47":"2012-09-01","48":"2012-10-01","49":"2012-11-01","50":"2012-12-01","51":"2013-01-01","52":"2013-02-01","53":"2013-03-01","54":"2013-04-01","55":"2013-05-01","56":"2013-06-01","57":"2013-07-01","58":"2013-08-01","59":"2013-09-01","60":"2013-10-01","61":"2013-11-01","62":"2013-12-01","63":"2014-01-01","64":"2014-02-01","65":"2014-03-01","66":"2014-04-01","67":"2014-05-01","68":"2014-06-01","69":"2014-07-01","70":"2014-08-01","71":"2014-09-01","72":"2014-10-01","73":"2014-11-01","74":"2014-12-01","75":"2015-01-01","76":"2015-02-01","77":"2015-03-01","78":"2015-04-01","79":"2015-05-01","80":"2015-06-01","81":"2015-07-01","82":"2015-08-01","83":"2015-09-01","84":"2015-10-01","85":"2015-11-01","86":"2015-12-01","87":"2016-01-01","88":"2016-02-01","89":"2016-03-01","90":"2016-04-01","91":"2016-05-01","92":"2016-06-01","93":"2016-07-01","94":"2016-08-01","95":"2016-09-01","96":"2016-10-01"},"Cluster 3":{"0":950.0,"1":2456.0,"2":3870.0,"3":5777.0,"4":7890.0,"5":10107.0,"6":12473.0,"7":15207.0,"8":18099.0,"9":21457.0,"10":24601.0,"11":27691.0,"12":31038.0,"13":34845.0,"14":38485.0,"15":42608.0,"16":46494.0,"17":50748.0,"18":54858.0,"19":58979.0,"20":63307.0,"21":68126.0,"22":73069.0,"23":77789.0,"24":82570.0,"25":88050.0,"26":93743.0,"27":99969.0,"28":106264.0,"29":114076.0,"30":121416.0,"31":129209.0,"32":136755.0,"33":144322.0,"34":152493.0,"35":159852.0,"36":166921.0,"37":175090.0,"38":182780.0,"39":191354.0,"40":200256.0,"41":209741.0,"42":219013.0,"43":228586.0,"44":237690.0,"45":247637.0,"46":257475.0,"47":266425.0,"48":276808.0,"49":286554.0,"50":295765.0,"51":306614.0,"52":316561.0,"53":328022.0,"54":339025.0,"55":349959.0,"56":360319.0,"57":371930.0,"58":383159.0,"59":393964.0,"60":405776.0,"61":416856.0,"62":427740.0,"63":440232.0,"64":452276.0,"65":465129.0,"66":476876.0,"67":487581.0,"68":497479.0,"69":508211.0,"70":518254.0,"71":528247.0,"72":538532.0,"73":548206.0,"74":557568.0,"75":567659.0,"76":577609.0,"77":588752.0,"78":600476.0,"79":611825.0,"80":623092.0,"81":634809.0,"82":645809.0,"83":656475.0,"84":667510.0,"85":677974.0,"86":688354.0,"87":699257.0,"88":710308.0,"89":722152.0,"90":733533.0,"91":744715.0,"92":755434.0,"93":766069.0,"94":777083.0,"95":787222.0,"96":791193.0},"Cluster 1":{"0":522.0,"1":1246.0,"2":2034.0,"3":3153.0,"4":4377.0,"5":5716.0,"6":7046.0,"7":8667.0,"8":10482.0,"9":12374.0,"10":14317.0,"11":16248.0,"12":18549.0,"13":20962.0,"14":23403.0,"15":26027.0,"16":28620.0,"17":31572.0,"18":34314.0,"19":37207.0,"20":40085.0,"21":43372.0,"22":46747.0,"23":49945.0,"24":53293.0,"25":57196.0,"26":61071.0,"27":65220.0,"28":69270.0,"29":74666.0,"30":79812.0,"31":85117.0,"32":90250.0,"33":95557.0,"34":101389.0,"35":106729.0,"36":111971.0,"37":117523.0,"38":122796.0,"39":128834.0,"40":135126.0,"41":141903.0,"42":148296.0,"43":154910.0,"44":161104.0,"45":167897.0,"46":174667.0,"47":180971.0,"48":188174.0,"49":195055.0,"50":201632.0,"51":209060.0,"52":216340.0,"53":224666.0,"54":232624.0,"55":240379.0,"56":247806.0,"57":256042.0,"58":264163.0,"59":271906.0,"60":280670.0,"61":288884.0,"62":296583.0,"63":305513.0,"64":314332.0,"65":323600.0,"66":332169.0,"67":339504.0,"68":346236.0,"69":353585.0,"70":360583.0,"71":367487.0,"72":374663.0,"73":381536.0,"74":388096.0,"75":394713.0,"76":401306.0,"77":408778.0,"78":416450.0,"79":424090.0,"80":431726.0,"81":439564.0,"82":446685.0,"83":453750.0,"84":461164.0,"85":468141.0,"86":475046.0,"87":482203.0,"88":489554.0,"89":497563.0,"90":505514.0,"91":512805.0,"92":519899.0,"93":526599.0,"94":533580.0,"95":540058.0,"96":542755.0},"Cluster 2":{"0":795.0,"1":2018.0,"2":3189.0,"3":5012.0,"4":6758.0,"5":8576.0,"6":10355.0,"7":12295.0,"8":14463.0,"9":16650.0,"10":18776.0,"11":20707.0,"12":23105.0,"13":25561.0,"14":27902.0,"15":30437.0,"16":32867.0,"17":35460.0,"18":37780.0,"19":40126.0,"20":42840.0,"21":45615.0,"22":48315.0,"23":50961.0,"24":53537.0,"25":56335.0,"26":59116.0,"27":62181.0,"28":65187.0,"29":68839.0,"30":72128.0,"31":75419.0,"32":78680.0,"33":81937.0,"34":85400.0,"35":88657.0,"36":91849.0,"37":95235.0,"38":98354.0,"39":101863.0,"40":105464.0,"41":109168.0,"42":112859.0,"43":116476.0,"44":119932.0,"45":123888.0,"46":127612.0,"47":131047.0,"48":134833.0,"49":138519.0,"50":142004.0,"51":146042.0,"52":149687.0,"53":153911.0,"54":157847.0,"55":161647.0,"56":165414.0,"57":169498.0,"58":173455.0,"59":177081.0,"60":181180.0,"61":185022.0,"62":188786.0,"63":193028.0,"64":196994.0,"65":201279.0,"66":205271.0,"67":208856.0,"68":212121.0,"69":215796.0,"70":219185.0,"71":222495.0,"72":225845.0,"73":229033.0,"74":232169.0,"75":235434.0,"76":238833.0,"77":242407.0,"78":246154.0,"79":249883.0,"80":253529.0,"81":257390.0,"82":260840.0,"83":264328.0,"84":267964.0,"85":271206.0,"86":274465.0,"87":277905.0,"88":281486.0,"89":285361.0,"90":289059.0,"91":292548.0,"92":295910.0,"93":299288.0,"94":302739.0,"95":305981.0,"96":307201.0},"Cluster 0":{"0":235.0,"1":597.0,"2":897.0,"3":1361.0,"4":1811.0,"5":2394.0,"6":2944.0,"7":3528.0,"8":4238.0,"9":5041.0,"10":5766.0,"11":6503.0,"12":7291.0,"13":8255.0,"14":9174.0,"15":10124.0,"16":11054.0,"17":12089.0,"18":13046.0,"19":14070.0,"20":15196.0,"21":16400.0,"22":17620.0,"23":18766.0,"24":20024.0,"25":21376.0,"26":22909.0,"27":24530.0,"28":26210.0,"29":28206.0,"30":29997.0,"31":31973.0,"32":33863.0,"33":35766.0,"34":37882.0,"35":39785.0,"36":41658.0,"37":43789.0,"38":45785.0,"39":48006.0,"40":50343.0,"41":52846.0,"42":55279.0,"43":57731.0,"44":60203.0,"45":62850.0,"46":65373.0,"47":67696.0,"48":70355.0,"49":72935.0,"50":75351.0,"51":78142.0,"52":80867.0,"53":84043.0,"54":87008.0,"55":89913.0,"56":92597.0,"57":95641.0,"58":98743.0,"59":101675.0,"60":104804.0,"61":107944.0,"62":110861.0,"63":114257.0,"64":117510.0,"65":121048.0,"66":124224.0,"67":127080.0,"68":129547.0,"69":132359.0,"70":134893.0,"71":137512.0,"72":140276.0,"73":142845.0,"74":145443.0,"75":148086.0,"76":150752.0,"77":153701.0,"78":156815.0,"79":159883.0,"80":162783.0,"81":165850.0,"82":168810.0,"83":171605.0,"84":174618.0,"85":177465.0,"86":180329.0,"87":183287.0,"88":186320.0,"89":189611.0,"90":192831.0,"91":195921.0,"92":198808.0,"93":201622.0,"94":204453.0,"95":207208.0,"96":208338.0},"Cluster 4":{"0":197.0,"1":464.0,"2":775.0,"3":1121.0,"4":1560.0,"5":1957.0,"6":2422.0,"7":3005.0,"8":3627.0,"9":4297.0,"10":5014.0,"11":5563.0,"12":6182.0,"13":6894.0,"14":7548.0,"15":8332.0,"16":9101.0,"17":9942.0,"18":10691.0,"19":11561.0,"20":12427.0,"21":13339.0,"22":14286.0,"23":15153.0,"24":16035.0,"25":17150.0,"26":18104.0,"27":19239.0,"28":20401.0,"29":21882.0,"30":23224.0,"31":24677.0,"32":25990.0,"33":27369.0,"34":28825.0,"35":30107.0,"36":31443.0,"37":32911.0,"38":34142.0,"39":35712.0,"40":37384.0,"41":39191.0,"42":40828.0,"43":42568.0,"44":44226.0,"45":45987.0,"46":47798.0,"47":49437.0,"48":51338.0,"49":53245.0,"50":54896.0,"51":56855.0,"52":58823.0,"53":60992.0,"54":63190.0,"55":65365.0,"56":67253.0,"57":69497.0,"58":71645.0,"59":73624.0,"60":75801.0,"61":77881.0,"62":79905.0,"63":82092.0,"64":84374.0,"65":86650.0,"66":88981.0,"67":91019.0,"68":92859.0,"69":94826.0,"70":96718.0,"71":98563.0,"72":100419.0,"73":102338.0,"74":104121.0,"75":106120.0,"76":108056.0,"77":110124.0,"78":112320.0,"79":114438.0,"80":116574.0,"81":118805.0,"82":120839.0,"83":122848.0,"84":124896.0,"85":126804.0,"86":128737.0,"87":130745.0,"88":132791.0,"89":135030.0,"90":137171.0,"91":139324.0,"92":141401.0,"93":143357.0,"94":145309.0,"95":147226.0,"96":147940.0}}';

	var vis_json = JSON.parse(vis_json_text);
	var vis_json_absolute = JSON.parse(vis_json_text_absolute);

	// Run function periodically to make things move.
	var timeout;
	var starting = 0;
	var nodesArrayIndex = 0;

	var total_count = 0;

	var total_count_yoy = 0;

	var month_year = vis_json["Month-Year"];
	var clusters = {
		0: vis_json["Cluster 0"],
		1: vis_json["Cluster 1"],
		2: vis_json["Cluster 2"],
		3: vis_json["Cluster 3"],
		4: vis_json["Cluster 4"],
	};
	var clusters_absolute = {
		0: vis_json_absolute["Cluster 0"],
		1: vis_json_absolute["Cluster 1"],
		2: vis_json_absolute["Cluster 2"],
		3: vis_json_absolute["Cluster 3"],
		4: vis_json_absolute["Cluster 4"],
	};

	var month = {
		"01": "Jan",
		"02": "Feb",
		"03": "Mar",
		"04": "Apr",
		"05": "May",
		"06": "Jun",
		"07": "Jul",
		"08": "Aug",
		"09": "Sep",
		"10": "Oct",
		"11": "Nov",
		"12": "Dec",
	};

	function timer() {

		var total_count_before = total_count;

		var index;
		for(index = 0; index < d3.keys(clusters).length; index++) {

			var curr_cluster = clusters[index];
			var curr_cluster_absolute = clusters_absolute[index];
			var nested_index;
			var choice = d3.keys(foci)[index];

			if(starting == 0) {

				for(nested_index = 0; nested_index < curr_cluster[starting]; nested_index++) {
					nodes[nodesArrayIndex].cx = foci[choice].x;
				    nodes[nodesArrayIndex].cy = foci[choice].y;
				    nodes[nodesArrayIndex].choice = choice;
				    nodesArrayIndex = nodesArrayIndex + 1;   
				}

				var counts = curr_cluster_absolute[starting];
				cluster_counts[String(index)] += counts;

			}

			else {

				var difference = curr_cluster[starting] - curr_cluster[starting-1];
				for(nested_index = 0; nested_index < difference; nested_index++) {
					nodes[nodesArrayIndex].cx = foci[choice].x;
				    nodes[nodesArrayIndex].cy = foci[choice].y;
				    nodes[nodesArrayIndex].choice = choice;
				    nodesArrayIndex = nodesArrayIndex + 1;   
				}

				var counts = curr_cluster_absolute[starting] - curr_cluster_absolute[starting-1];
				var yoy = counts/curr_cluster_absolute[starting-1];

				cluster_counts[String(index)] += counts;
				cluster_yoy[String(index)] = yoy;

			}

			total_count += counts;

		}

		if(total_count_before != 0) total_count_yoy = (total_count - total_count_before)/total_count_before;

		d3.select("#current_time").text(month[month_year[starting].split("-")[1]] + " " + month_year[starting].split("-")[0]);

		starting++;

		label.selectAll("tspan.num")
			.text(function(d) {
				return "[" + cluster_counts[d.index] + ", " + 
				readablePercent(cluster_counts[d.index]/total_count) + ", " +
				readableChange(cluster_yoy[d.index]) + "]";
			});

		d3.select("#total_num_bottom")
			.text(function(d) {
				return String(total_count) + ", " + readableChange(total_count_yoy);
			});
	    
	    force.resume();
	    
	    // Run it again in a few seconds.
	    if(starting <= 96) timeout = setTimeout(timer, speeds[USER_SPEED]);
	}

	timeout = setTimeout(timer, speeds[USER_SPEED]);

	//
	// Force-directed boiler plate functions
	//

	function tick(e) {
		circle
		.each(gravity(.051 * e.alpha))
	  	.each(collide(.5))
	  	.style("fill", function(d) { return foci[d.choice].color; })
	    .attr("cx", function(d) { return d.x; })
	    .attr("cy", function(d) { return d.y; });
	}


	// Move nodes toward cluster focus.
	function gravity(alpha) {
		return function(d) {
			d.y += (foci[d.choice].y - d.y) * alpha;
			d.x += (foci[d.choice].x - d.x) * alpha;
		};
	}

	// Resolve collisions between nodes.
	function collide(alpha) {
		var quadtree = d3.geom.quadtree(nodes);
		return function(d) {
			var r = d.radius + node_radius + Math.max(padding, cluster_padding),
	        nx1 = d.x - r,
	        nx2 = d.x + r,
	        ny1 = d.y - r,
	        ny2 = d.y + r;
	        quadtree.visit(function(quad, x1, y1, x2, y2) {
	         	if (quad.point && (quad.point !== d)) {
	         		var x = d.x - quad.point.x,
	         		y = d.y - quad.point.y,
	         		l = Math.sqrt(x * x + y * y),
	         		r = d.radius + quad.point.radius + (d.choice === quad.point.choice ? padding : cluster_padding);
	         		if (l < r) {
	         			l = (l - r) / l * alpha;
	         			d.x -= x *= l;
	         			d.y -= y *= l;
	         			quad.point.x += x;
	         			quad.point.y += y;
	         		}
	         	}
	         return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
	        })
	    };
	}

	d3.selectAll(".togglebutton")
      .on("click", function() {
        if (d3.select(this).attr("data-val") == "slow") {
            d3.select(".slow").classed("current", true);
			d3.select(".medium").classed("current", false);
            d3.select(".fast").classed("current", false);
        } else if (d3.select(this).attr("data-val") == "medium") {
            d3.select(".slow").classed("current", false);
			d3.select(".medium").classed("current", true);
            d3.select(".fast").classed("current", false);
        } 
		else {
            d3.select(".slow").classed("current", false);
			d3.select(".medium").classed("current", false);
			d3.select(".fast").classed("current", true);
        }
		
		USER_SPEED = d3.select(this).attr("data-val");
    });

    // Output readable percent based on count.
	function readablePercent(n) {
	
		var pct;
		if (n < 0.01) {
			pct = "<1%";
		} else {
			pct = (n * 100).toFixed(1) + "%";
		}
	
		return pct;
	}

	function readableChange(n) {

		var change;
		if (n < 0) {
			change = "-" + readablePercent(n);
		}
		else if (n == 0) {
			change = "0.0%";
		}
		else {
			if(readablePercent(n) != "<1%") change = "+" + readablePercent(n);
			else change = readablePercent(n);
		}
		return change;

	}

	</script>

</body>